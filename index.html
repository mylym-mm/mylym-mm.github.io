<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"mylym-mm.github.io","root":"/","images":"/images","scheme":"Gemini","version":"8.3.0","exturl":false,"sidebar":{"position":"right","display":"always","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}};
  </script>
<meta name="description" content="my的修炼之路">
<meta property="og:type" content="website">
<meta property="og:title" content="my鱼">
<meta property="og:url" content="https://mylym-mm.github.io/index.html">
<meta property="og:site_name" content="my鱼">
<meta property="og:description" content="my的修炼之路">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="lym">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://mylym-mm.github.io/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>
<title>my鱼</title>
  




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">my鱼</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">:)进步中</p>
      <img class="custom-logo-image" src="/uploads/fish.png" alt="my鱼">
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="lym"
      src="/uploads/hylike.jpg">
  <p class="site-author-name" itemprop="name">lym</p>
  <div class="site-description" itemprop="description">my的修炼之路</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">26</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://mylym-mm.github.io/2021/09/24/02-29-41/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/hylike.jpg">
      <meta itemprop="name" content="lym">
      <meta itemprop="description" content="my的修炼之路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="my鱼">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/24/02-29-41/" class="post-title-link" itemprop="url">9-24-关注前端消息有哪些渠道</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-09-24 02:29:41" itemprop="dateCreated datePublished" datetime="2021-09-24T02:29:41+08:00">2021-09-24</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://mylym-mm.github.io/2021/09/24/02-23-05/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/hylike.jpg">
      <meta itemprop="name" content="lym">
      <meta itemprop="description" content="my的修炼之路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="my鱼">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/24/02-23-05/" class="post-title-link" itemprop="url">9-24-灰度测试灰度发布</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-09-24 02:23:05" itemprop="dateCreated datePublished" datetime="2021-09-24T02:23:05+08:00">2021-09-24</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://mylym-mm.github.io/2021/09/24/02-09-30/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/hylike.jpg">
      <meta itemprop="name" content="lym">
      <meta itemprop="description" content="my的修炼之路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="my鱼">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/24/02-09-30/" class="post-title-link" itemprop="url">9-24-如何搭建Https服务器</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-09-24 02:09:30" itemprop="dateCreated datePublished" datetime="2021-09-24T02:09:30+08:00">2021-09-24</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://mylym-mm.github.io/2021/09/24/01-31-18/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/hylike.jpg">
      <meta itemprop="name" content="lym">
      <meta itemprop="description" content="my的修炼之路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="my鱼">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/24/01-31-18/" class="post-title-link" itemprop="url">9-24-nginx</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-09-24 01:31:18" itemprop="dateCreated datePublished" datetime="2021-09-24T01:31:18+08:00">2021-09-24</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://mylym-mm.github.io/2021/09/23/00-58-59/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/hylike.jpg">
      <meta itemprop="name" content="lym">
      <meta itemprop="description" content="my的修炼之路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="my鱼">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/23/00-58-59/" class="post-title-link" itemprop="url">9-23-JS题</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-09-23 00:58:59 / Modified: 02:07:18" itemprop="dateCreated datePublished" datetime="2021-09-23T00:58:59+08:00">2021-09-23</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="JS-Tricks-from-JS-puzzlers"><a href="#JS-Tricks-from-JS-puzzlers" class="headerlink" title="JS Tricks from JS-puzzlers"></a>JS Tricks from JS-puzzlers</h1><p><a target="_blank" rel="noopener" href="http://javascript-puzzlers.herokuapp.com/">Javascript-Puzzlers</a> is a nice place for people to.. test their JS knowledge :)</p>
<p>I wrote some code to learn&amp;verify JS’s behaviour while solving the problems. I’ll try to put the result below.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Question #1: [&quot;1&quot;, &quot;2&quot;, &quot;3&quot;].map(parseInt) </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Verify as below</span></span><br><span class="line"><span class="keyword">var</span> a = [<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;2&#x27;</span>,<span class="string">&#x27;3&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// This would show the input that `map` feeds to the callback</span></span><br><span class="line">a.map(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="built_in">arguments</span>);&#125;);</span><br><span class="line"><span class="comment">// output of one of the lines: &#123; &#x27;0&#x27;: &#x27;1&#x27;, &#x27;1&#x27;: 0, &#x27;2&#x27;: [ &#x27;1&#x27;, &#x27;2&#x27;, &#x27;3&#x27; ] &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log( <span class="built_in">parseInt</span>(<span class="string">&#x27;1&#x27;</span>,<span class="number">0</span>));  <span class="comment">// output: 1</span></span><br><span class="line"><span class="built_in">console</span>.log( <span class="built_in">parseInt</span>(<span class="string">&#x27;2&#x27;</span>,<span class="number">1</span>));  <span class="comment">// output: NaN</span></span><br></pre></td></tr></table></figure>



<h2 id="知识点：argument"><a href="#知识点：argument" class="headerlink" title="知识点：argument"></a>知识点：argument</h2><p>————————————————<br>版权声明：本文为CSDN博主「前丨端丨小丨学丨生」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/xiaotao_css/article/details/72794650">https://blog.csdn.net/xiaotao_css/article/details/72794650</a></p>
<h3 id="1-什么是-arguments"><a href="#1-什么是-arguments" class="headerlink" title="1. 什么是 arguments"></a><strong>1. 什么是 arguments</strong></h3><p>百度说：<strong>arguments 是一个类数组对象</strong>。<strong>代表传给一个function的参数列表。（读不懂，看下面代码）</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printArgs</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">arguments</span>);</span><br><span class="line">&#125;</span><br><span class="line">printArgs(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="number">0</span>, &#123; <span class="attr">foo</span>: <span class="string">&quot;Hello, arguments&quot;</span> &#125;)；</span><br></pre></td></tr></table></figure>

<p>执行结果是：</p>
<p>[“A”, “a”, 0, Object]</p>
<p>控制台打印出来的是一个数组，但并不是真正的数组，所以说<strong>arguments 是一个类数组的对象，我叫他伪数组</strong>。</p>
<p>测试在函数内部打印 console.log(arguments[2]);   //0</p>
<h3 id="2-arguments-操作"><a href="#2-arguments-操作" class="headerlink" title="2.arguments 操作"></a>2.arguments 操作</h3><h3 id="2-1-arguments-length"><a href="#2-1-arguments-length" class="headerlink" title="2.1 arguments length"></a>2.1 arguments length</h3><p>arguments 是个类数组对象，其包含一个 length 属性，可以用 arguments.length 来获得传入函数的参数个数。</p>
<p>function func() {</p>
<pre><code>console.log(&quot;The number of parameters is &quot; + arguments.length);
</code></pre>
<p>}</p>
<p>func();</p>
<p>func(1, 2);</p>
<p>func(1, 2, 3);</p>
<p>执行结果如下：</p>
<p>The number of parameters is 0</p>
<p>The number of parameters is 2</p>
<p>The number of parameters is 3</p>
<h3 id="2-2-arguments-转数组"><a href="#2-2-arguments-转数组" class="headerlink" title="2.2 arguments 转数组"></a>2.2 arguments 转数组</h3><p>通常使用下面的方法来将 arguments 转换成数组：</p>
<p>Array.prototype.slice.call(arguments);</p>
<p>还有一个更简短的写法：</p>
<p>[ ].slice.call(arguments);</p>
<p>在这里，只是简单地调用了空数组的 slice 方法，而没有从 Array 的原型层面调用。</p>
<p>问：为什么上面两种方法可以转换呢？<br>首先，slice 方法得到的结果是一个数组，参数便是 arguments。事实上，满足一定条件的对象都能被 slice 方法转换成数组。看个例子：</p>
<p>const obj = { 0: “A”, 1: “B”, length: 2 };</p>
<p>const result = [].slice.call(obj);</p>
<p>console.log(Array.isArray(result), result);   //true [“A”, “B”]</p>
<p>从上面例子可以看出，条件就是： </p>
<ol>
<li>属性为 0，1，2…；</li>
</ol>
<p>2） 具有 length 属性；</p>
<h3 id="2-3-修改-arguments-值"><a href="#2-3-修改-arguments-值" class="headerlink" title="2.3 修改 arguments 值"></a><strong>2.3 修改 arguments 值</strong></h3><p>在严格模式与非严格模式下，修改函数参数值表现的结果不一样。</p>
<p>function foo(a) {   </p>
<p> “use strict”;</p>
<pre><code>console.log(a, arguments[0]);

a = 10;

console.log(a, arguments[0]);

arguments[0] = 20;

console.log(a, arguments[0]);
</code></pre>
<p>}</p>
<p>foo(1);</p>
<p>输出：</p>
<p>1 1</p>
<p>10 1</p>
<p>10 20</p>
<p>另一个非严格模式的例子：</p>
<p>function foo(a) {</p>
<pre><code>console.log(a, arguments[0]);

a = 10;

console.log(a, arguments[0]);

arguments[0] = 20;

console.log(a, arguments[0]);
</code></pre>
<p>}</p>
<p>foo(1);</p>
<p>输出结果为：</p>
<p>1 1</p>
<p>10 10</p>
<p>20 20</p>
<p>从上面的两个例子中可以看出，在严格模式下，函数中的参数与 arguments 对象没有联系，修改一个值不会改变另一个值。而在非严格模式下，两个会互相影响。</p>
<h3 id="2-4-将参数从一个函数传递到另一个函数"><a href="#2-4-将参数从一个函数传递到另一个函数" class="headerlink" title="2.4 将参数从一个函数传递到另一个函数"></a>2.4 将参数从一个函数传递到另一个函数</h3><p>下面是将参数从一个函数传递到另一个函数的推荐做法。</p>
<p>function foo() {</p>
<pre><code>bar.apply(this, arguments);
</code></pre>
<p>}function bar(a, b, c) {</p>
<pre><code>// logic
</code></pre>
<p>}</p>
<h3 id="2-5-arguments-与重载"><a href="#2-5-arguments-与重载" class="headerlink" title="2.5 arguments 与重载"></a>2.5 arguments 与重载</h3><p>很多语言中都有重载，但 JavaScript 中没有。先看个例子：</p>
<p>function add(num1, num2) {</p>
<pre><code>console.log(&quot;Method one&quot;);

return num1 + num2;
</code></pre>
<p>}</p>
<p>function add(num1, num2, num3) {</p>
<pre><code>console.log(&quot;Method two&quot;);

return num1 + num2 + num3;
</code></pre>
<p>}</p>
<p>add(1, 2);</p>
<p>add(1, 2, 3);</p>
<p>执行结果为：</p>
<p>Method two</p>
<p>Method two</p>
<p>所以，JavaScript 中，函数并没有根据参数的不同而产生不同的调用。</p>
<p>是不是 JavaScript 中就没有重载了呢？并不是，我们可以利用 arguments 模拟重载。还是上面的例子。</p>
<p>function add(num1, num2, num3) {</p>
<pre><code>if (arguments.length === 2) &#123;

    console.log(&quot;Result is &quot; + (num1 + num2));

&#125;

else if (arguments.length === 3) &#123;

    console.log(&quot;Result is &quot; + (num1 + num2 + num3));

&#125;
</code></pre>
<p>}</p>
<p>add(1, 2);</p>
<p>add(1, 2, 3)</p>
<p>执行结果如下：</p>
<p>Result is 3Result is 6</p>
<ol start="3">
<li><h3 id="ES6-中的-arguments"><a href="#ES6-中的-arguments" class="headerlink" title="ES6 中的 arguments"></a>ES6 中的 arguments</h3></li>
</ol>
<h3 id="3-1-扩展操作符"><a href="#3-1-扩展操作符" class="headerlink" title="3.1 扩展操作符"></a>3.1 扩展操作符</h3><p>function func() {</p>
<pre><code>console.log(...arguments);
</code></pre>
<p>}</p>
<p>func(1, 2, 3);</p>
<p>执行结果是：</p>
<p>1 2 3</p>
<p>简洁地讲，扩展操作符可以将 arguments 展开成独立的参数。</p>
<h3 id="3-2-Rest-参数"><a href="#3-2-Rest-参数" class="headerlink" title="3.2 Rest 参数"></a>3.2 Rest 参数</h3><p>function func(firstArg, …restArgs) {</p>
<pre><code>console.log(Array.isArray(restArgs));

console.log(firstArg, restArgs);
</code></pre>
<p>}</p>
<p>func(1, 2, 3);</p>
<p>执行结果是：</p>
<p>true1 [2, 3]</p>
<p>从上面的结果可以看出，Rest 参数表示除了明确指定剩下的参数集合，类型是 Array。</p>
<h3 id="3-3-默认参数"><a href="#3-3-默认参数" class="headerlink" title="3.3 默认参数"></a>3.3 默认参数</h3><p>栗子：</p>
<p>function func(firstArg = 0, secondArg = 1) {</p>
<pre><code>console.log(arguments[0], arguments[1]);

console.log(firstArg, secondArg);
</code></pre>
<p>}</p>
<p>func(99);</p>
<p>执行结果是：</p>
<p>99 undefined99 1</p>
<p>可见，默认参数对 arguments 没有影响，arguments 还是仅仅表示调用函数时所传入的所有参数。</p>
<h3 id="3-4-arguments-转数组"><a href="#3-4-arguments-转数组" class="headerlink" title="3.4 arguments 转数组"></a><strong>3.4 arguments 转数组</strong></h3><p>Array.from() 是个非常推荐的方法，其可以将所有类数组对象转换成数组。</p>
<h3 id="4-数组与类数组对象"><a href="#4-数组与类数组对象" class="headerlink" title="4.数组与类数组对象"></a>4.数组与类数组对象</h3><p>数组具有一个基本特征：索引。这是一般对象所没有的。</p>
<p>const obj = { 0: “a”, 1: “b” };const arr = [ “a”, “b” ];</p>
<p>我们利用 obj[0]、arr[0] 都能取得自己想要的数据，但取得数据的方式确实不同的。obj[0] 是利用对象的键值对存取数据，而arr[0] 却是利用数组的索引。事实上，Object 与 Array 的唯一区别就是 Object 的属性是 string，而 Array 的索引是 number。</p>
<p>下面看看类数组对象。</p>
<p>伪数组的特性就是长得像数组，包含一组数据以及拥有一个 length 属性，但是没有任何 Array 的方法。再具体的说，length 属性是个非负整数，上限是 JavaScript 中能精确表达的最大数字；另外，类数组对象的 length 值无法自动改变。</p>
<p>如何自己创建一个类数组对象？</p>
<p>function Foo() {}</p>
<p>Foo.prototype = Object.create(Array.prototype);</p>
<p>const foo = new Foo();</p>
<p>foo.push(‘A’);console.log(foo, foo.length);console.log(“foo is an array? “ + Array.isArray(foo));</p>
<p>执行结果是：</p>
<p>[“A”] 1</p>
<p>foo is an array? false</p>
<p>也就是说 Foo 的示例拥有 Array 的所有方法，但类型不是 Array。</p>
<p>如果不需要 Array 的所有方法，只需要部分怎么办呢？</p>
<p>function Bar() {}</p>
<p>Bar.prototype.push = Array.prototype.push;</p>
<p>const bar = new Bar();</p>
<p>bar.push(‘A’);</p>
<p>bar.push(‘B’);console.log(bar);</p>
<p>执行结果是：</p>
<p>Bar {0: “A”, 1: “B”, length: 2}<br>————————————————<br>版权声明：本文为CSDN博主「前丨端丨小丨学丨生」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/xiaotao_css/article/details/72794650">https://blog.csdn.net/xiaotao_css/article/details/72794650</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://mylym-mm.github.io/2021/09/19/17-16-35/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/hylike.jpg">
      <meta itemprop="name" content="lym">
      <meta itemprop="description" content="my的修炼之路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="my鱼">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/19/17-16-35/" class="post-title-link" itemprop="url">web Socket</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-09-19 17:16:35" itemprop="dateCreated datePublished" datetime="2021-09-19T17:16:35+08:00">2021-09-19</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://mylym-mm.github.io/2021/09/19/17-16-15/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/hylike.jpg">
      <meta itemprop="name" content="lym">
      <meta itemprop="description" content="my的修炼之路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="my鱼">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/19/17-16-15/" class="post-title-link" itemprop="url">9.19-数据结构与算法1</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-09-19 17:16:15" itemprop="dateCreated datePublished" datetime="2021-09-19T17:16:15+08:00">2021-09-19</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-09-21 04:52:23" itemprop="dateModified" datetime="2021-09-21T04:52:23+08:00">2021-09-21</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>1.什么是数据结构？</p>
<ul>
<li>数组、链表、队列、栈、堆、二叉树、图</li>
<li>如果一定要给出一个官方的解释，那么它就是：<br><strong>计算机存储、组织数据的方式。相互之间存在一种或多种特定关系的数据元素的集合。</strong>通常情况下，精心选择的数据结构可以带来更高的运行或者存储效率。往往同高效的检索算法和索引技术有关。</li>
</ul>
<p>2.数据结构和算法的关系</p>
<ul>
<li>数据结构主要讲解数据的组织形式，比如链表，堆，栈，队列。</li>
<li>而算法，则注重的是思想，比如链表的元素怎么插入、删除、查找？堆的元素怎么弹出来？栈为什么是先进后出的？队列又为什么是先进先出？</li>
<li>讲的直白一点，数据结构是有实体的，算法是虚拟的；数据结构是物质上的，算法是精神上的。当然，精神与物质是缺一不可的。</li>
</ul>
<p>3.数据结构概览</p>
<p><img src="C:\Users\mylym\AppData\Roaming\Typora\typora-user-images\image-20210920005857021.png" alt="image-20210920005857021"></p>
<p>4.算法入门</p>
<p><img src="C:\Users\mylym\AppData\Roaming\Typora\typora-user-images\image-20210920005903869.png" alt="image-20210920005903869"></p>
<p><img src="C:\Users\mylym\AppData\Roaming\Typora\typora-user-images\image-20210920010119893.png" alt="image-20210920010119893"></p>
<h1 id="算法入门《前缀和》简单01-——-LeetCode-724-寻找数组的中心索引"><a href="#算法入门《前缀和》简单01-——-LeetCode-724-寻找数组的中心索引" class="headerlink" title="算法入门《前缀和》简单01 —— LeetCode 724 寻找数组的中心索引"></a><strong>算法入门</strong>《前缀和》简单01 —— LeetCode 724 寻找数组的中心索引</h1><h3 id="文章目录"><a href="#文章目录" class="headerlink" title="文章目录"></a>文章目录</h3><ul>
<li><p>一、题目</p>
</li>
<li><ul>
<li>1、题目描述</li>
<li>2、基础框架</li>
<li>3、原题链接</li>
</ul>
</li>
<li><p>二、解题报告</p>
</li>
<li><ul>
<li>1、思路分析</li>
<li>2、时间复杂度</li>
<li>3、代码详解</li>
</ul>
</li>
<li><p>三、本题小知识</p>
</li>
</ul>
<h3 id="一、题目"><a href="#一、题目" class="headerlink" title="一、题目"></a>一、题目</h3><h4 id="1、题目描述"><a href="#1、题目描述" class="headerlink" title="1、题目描述"></a>1、题目描述</h4><pre><code>  给定一个整数数组nums，请计算数组的中心下标 。数组中心下标是数组的一个下标，其左侧所有元素相加的和等于右侧所有元素相加的和。如果中心下标位于数组最左端，那么左侧数之和视为 0 ，因为在下标的左侧不存在元素。这一点对于中心下标位于数组最右端同样适用。如果数组有多个中心下标，应该返回 最靠近左边 的那一个。如果数组不存在中心下标，返回 -1。
  样例输入： nums = [1, 7, 3, 6, 5, 6]
  样例输出： 3
</code></pre>
<h4 id="2、基础框架"><a href="#2、基础框架" class="headerlink" title="2、基础框架"></a>2、基础框架</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;number[]&#125;</span> <span class="variable">nums</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;number&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> pivotIndex = <span class="function"><span class="keyword">function</span>(<span class="params">nums</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="3、原题链接"><a href="#3、原题链接" class="headerlink" title="3、原题链接"></a>3、原题链接</h4><blockquote>
<p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/find-pivot-index/">LeetCode 724. 寻找数组的中心下标</a><br> <a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/tvdfij/">LeetCode 剑指 Offer II 012. 左右两边子数组的和相等</a></p>
</blockquote>
<h3 id="二、解题报告"><a href="#二、解题报告" class="headerlink" title="二、解题报告"></a>二、解题报告</h3><h4 id="1、思路分析"><a href="#1、思路分析" class="headerlink" title="1、思路分析"></a>1、思路分析</h4><p>记数组的全部元素之和为 sum，当遍历到第 i 个元素时，设其左侧元素之和为 curSum，则2×curSum+nums[i]=total.</p>
<p>当中心索引左侧或右侧没有元素时，即为零个项相加，这在数学上称作「空和」（empty sum）。在程序设计中我们约定「空和是零」。</p>
<h4 id="2、时间复杂度"><a href="#2、时间复杂度" class="headerlink" title="2、时间复杂度"></a>2、时间复杂度</h4><pre><code>总共两次遍历，一次计算前缀和，一次枚举判定，所以总的时间复杂度为 O(n)。
</code></pre>
<h4 id="3、代码详解"><a href="#3、代码详解" class="headerlink" title="3、代码详解"></a>3、代码详解</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;number[]&#125;</span> <span class="variable">nums</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;number&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> pivotIndex = <span class="function"><span class="keyword">function</span>(<span class="params">nums</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> sum = nums.reduce(<span class="function">(<span class="params">pre,cur</span>)=&gt;</span>pre + cur,<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">let</span> curSum = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>,len = nums.length;i&lt;len;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(curSum*<span class="number">2</span> + nums[i] == sum)&#123;</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            curSum += nums[i]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<h3 id="三、本题小知识"><a href="#三、本题小知识" class="headerlink" title="三、本题小知识"></a>三、本题小知识</h3><p>前缀和 可以在  O(n) 的时间内进行预处理， O(1) 的时间进行求和。</p>
<h1 id="算法入门《前缀和》中等02-——-LeetCode-974-和可被K整除的子数组"><a href="#算法入门《前缀和》中等02-——-LeetCode-974-和可被K整除的子数组" class="headerlink" title="算法入门《前缀和》中等02 —— LeetCode 974 和可被K整除的子数组"></a><strong>算法入门</strong>《前缀和》中等02 —— LeetCode 974 和可被K整除的子数组</h1><h3 id="一、题目-1"><a href="#一、题目-1" class="headerlink" title="一、题目"></a>一、题目</h3><h4 id="1、题目描述-1"><a href="#1、题目描述-1" class="headerlink" title="1、题目描述"></a>1、题目描述</h4><pre><code>  给定一个整数数组 A，返回其中元素之和可被 K 整除的（连续、非空）子数组的数目。
  样例输入： A = [4,5,0,-2,-3,1], K = 5
  样例输出： 7
</code></pre>
<h4 id="2、基础框架-1"><a href="#2、基础框架-1" class="headerlink" title="2、基础框架"></a>2、基础框架</h4><pre><code>/**
 * @param &#123;number[]&#125; nums
 * @param &#123;number&#125; k
 * @return &#123;number&#125;
 */
var subarraysDivByK = function(nums, k) &#123;

&#125;;
</code></pre>
<h4 id="3、原题链接-1"><a href="#3、原题链接-1" class="headerlink" title="3、原题链接"></a>3、原题链接</h4><blockquote>
<p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/subarray-sums-divisible-by-k/">LeetCode 974. 和可被 K 整除的子数组</a></p>
</blockquote>
<h3 id="二、解题报告-1"><a href="#二、解题报告-1" class="headerlink" title="二、解题报告"></a>二、解题报告</h3><h4 id="1、思路分析-1"><a href="#1、思路分析-1" class="headerlink" title="1、思路分析"></a>1、思路分析</h4><p>作者：xiao_ben_zhu<br>链接：<a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/subarray-sums-divisible-by-k/solution/you-jian-qian-zhui-he-na-jiu-zai-ci-dai-ni-da-tong/">https://leetcode-cn.com/problems/subarray-sums-divisible-by-k/solution/you-jian-qian-zhui-he-na-jiu-zai-ci-dai-ni-da-tong/</a><br>来源：力扣（LeetCode）</p>
<p><strong>什么是前缀和</strong></p>
<pre><code>前缀和：数组 第 0 项 到 当前项 的和。用一个数组 preSum 表示：
preSum[i]=A[0]+A[1]+…+A[i]

数组第 i 项可以表示为相邻前缀和之差：
A[i]=preSum[i]−preSum[i−1]

多项叠加，有：
A[i]+…+A[j]=preSum[j]−preSum[i−1]

i 可以为 0，此时 i - 1 为 - 1，我们故意让 preSum[−1] 为 0，此时有：
A[0]+A[1]+…+A[j]=preSum[j]
设置这种不存在的情况，只是为了让边界情况也能套用通式。
</code></pre>
<p><strong>题目等价转化</strong></p>
<pre><code>子数组的元素之和 =&gt; A[i] 到 A[j]的和
元素和能被 K 整除的子数组数目 =&gt; 有几种i、j组合，使得A[i]到A[j]之和 mod K == 0
↓ ↓ ↓ 转化为 ↓ ↓ ↓
有几种 i、j 组合，满足 (preSum[j]−preSum[i−1])mod K==0
有几种 i、j 组合，满足 preSum[j] mod K == preSum[i−1]mod K。
    前提：preSum[j] 、preSum[i−1] 为正整数。负数的情况要处理。
</code></pre>
<p><strong>前缀和怎么求</strong></p>
<pre><code>数组当前项的前缀和 = 上一项的前缀和 + 数组当前项
我们可以求出数组 A 每一项的前缀和，让它 mod K，mod 完再看哪两项相等，去计数。
但前面通式有i、j两个变量，找出所有相等的两项，需要两层循环，能否优化呢？
</code></pre>
<p>我们只关心：<strong>数值和出现次数</strong></p>
<pre><code>数组A的元素都有自己的前缀和，但我们不关心前缀和对应了哪一项。我们只关心出现过哪些「前缀和 mod K」的值，以及出现这个值的次数。
用一个变量 preSumModK，将每次求出的「前缀和 mod K」，存入哈希表：
    key：前缀和 mod K
    value：这个值出现的次数
「前缀和 mod K」值恰好是 0,1,2...,K-1，正好和索引对应，所以也可以用数组去存。
</code></pre>
<p>找到 preSumModK 的递推关系，用于迭代计算</p>
<pre><code>模的分配率： (a + b) mod c = (a mod c + b mod c) mod c
当前的 preSumModK
= ( 当前的前缀和 ) mod K
= ( 上一项的前缀和 + A[i]) mod K
= ( 上一项的前缀和) mod K + A[i]mod K) mod K
= ( 上一个 preSumModK + A[i] mod K ) mod K
= ( 上一个 preSumModK + A[i] ) mod K
前后的 preSumModK 有了递推关系，可以在迭代中计算。
</code></pre>
<p>整个流程</p>
<pre><code>预置 preSum[-1] = 0
    遍历数组 A 之前，map 提前放入 0:1 键值对，代表求第 0 项前缀和之前，前缀和 mod K 等于 0 这种情况出现了 1 次。
遍历数组 A，求当前项的 preSumModK ，存入 map 中：
    之前没有存过，则作为 key 存入，value 为 1。
    之前存过了，则 value 加 1。
边存边查看，如果 map 中已经存在 key 等于当前的 preSumModK：
    说明存在之前求过的 preSumModK 等于 当前 preSumModK，把 key 对应的出现次数，累加给 count。
    过去的这个前缀，与当前的前缀，差分出一个子数组，过去的这个前缀和出现过几次 ，就是有几个过去的前缀，与当前前缀，差分出几个满足条件的子数组。
</code></pre>
<p>尝试一句话概括</p>
<pre><code>根据当前前缀和 mod K，在哈希表中找到与之相等的 key。满足条件的 历史preSumModK 出现过 n 次，就是当前前缀和 能找到 n 个历史前缀和，与之形成 n 个不同的子数组，满足元素和能被 K 整除。
遍历数组 A 每一项，做以上步骤，n 不断累加给 count，最后返回 count
</code></pre>
<p>补充：前缀和 为负数 的情况</p>
<pre><code>拿K = 4为例，求出某个前缀和为 -1，-1 % K 应该为 3，但有的编程语言 -1 % K = -1
这个 -1，要加上 K，转成正数的 3。
为什么？为什么 preSum 值为 -1 和 3 需要归为同一类？因为：
-1 和 3 分别模 4 的结果看似不相等，但前缀和之差：3-(-1) 等于 4。4 % K = 0，即所形成的子数组满足元素和被 4 整除。所以前缀和 -1 和 3 其实是等价的。
</code></pre>
<h4 id="2、复杂度"><a href="#2、复杂度" class="headerlink" title="2、复杂度"></a>2、复杂度</h4><p>Time：O(n)<br> Space：O(K)。 mod 的结果最多 K 种，哈希表最多存放 K 个键值对</p>
<h4 id="3、代码详解-1"><a href="#3、代码详解-1" class="headerlink" title="3、代码详解"></a>3、代码详解</h4><h5 id="解法1："><a href="#解法1：" class="headerlink" title="解法1："></a>解法1：</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> subarraysDivByK = <span class="function">(<span class="params">A, K</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> preSumModK = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">let</span> count = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">const</span> map = &#123; <span class="number">0</span>: <span class="number">1</span> &#125;;<span class="comment">// 初始化哈希表，并且插入第一个元素sum[-1]</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; A.length; i++) &#123;</span><br><span class="line">    preSumModK = (preSumModK + A[i]) % K; <span class="comment">// 递推式子 计算前缀和模 k</span></span><br><span class="line">    <span class="keyword">if</span> (preSumModK &lt; <span class="number">0</span>) &#123;  <span class="comment">//确保每个sum[i]都是大于等于0的；</span></span><br><span class="line">      preSumModK += K;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (map[preSumModK]) &#123;      <span class="comment">// 已经存在于map</span></span><br><span class="line">      count += map[preSumModK]; <span class="comment">// 把对应的次数累加给count</span></span><br><span class="line">      map[preSumModK]++;        <span class="comment">// 并且更新出现次数，次数+1</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      map[preSumModK] = <span class="number">1</span>;      <span class="comment">// 之前没出现过，初始化值为1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> count;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">作者：xiao_ben_zhu</span><br></pre></td></tr></table></figure>

<h5 id="解法2：用数组代替哈希表存mod"><a href="#解法2：用数组代替哈希表存mod" class="headerlink" title="解法2：用数组代替哈希表存mod"></a>解法2：用数组代替哈希表存mod</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> subarraysDivByK = <span class="function">(<span class="params">A, K</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> preSumModK = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">let</span> count = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">const</span> map = <span class="keyword">new</span> <span class="built_in">Array</span>(K).fill(<span class="number">0</span>);</span><br><span class="line">  map[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; A.length; i++) &#123;     </span><br><span class="line">    preSumModK = (preSumModK + A[i]) % K;</span><br><span class="line">    <span class="keyword">if</span> (preSumModK &lt; <span class="number">0</span>) &#123;</span><br><span class="line">      preSumModK += K;</span><br><span class="line">    &#125;</span><br><span class="line">    count += map[preSumModK]; <span class="comment">// 索引对应模的结果，值对应出现次数</span></span><br><span class="line">    map[preSumModK]++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> count;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">作者：xiao_ben_zhu</span><br></pre></td></tr></table></figure>



<h3 id="三、本题小知识-1"><a href="#三、本题小知识-1" class="headerlink" title="三、本题小知识"></a>三、本题小知识</h3><pre><code>前缀和的问题，一般是先初始化前缀和，然后再进行一次线性枚举，通过 O(1) 的时间取前缀和的结果。
</code></pre>
<h1 id="算法入门《前缀和》中等03-——-LeetCode-1248-统计-优美子数组"><a href="#算法入门《前缀和》中等03-——-LeetCode-1248-统计-优美子数组" class="headerlink" title="算法入门《前缀和》中等03 —— LeetCode 1248 统计[优美子数组]"></a><strong>算法入门</strong>《前缀和》中等03 —— LeetCode 1248 统计[优美子数组]</h1><h3 id="一、题目-2"><a href="#一、题目-2" class="headerlink" title="一、题目"></a>一、题目</h3><h4 id="1、题目描述-2"><a href="#1、题目描述-2" class="headerlink" title="1、题目描述"></a>1、题目描述</h4><pre><code>  给你一个整数数组 nums 和一个整数 k 。如果某个连续子数组中恰好有 k 个奇数数字，我们就认为这个子数组是「优美子数组」。请返回这个数组中「优美子数组」的数目。
  样例输入： nums = [1,1,2,1,1], k = 3
  样例输出： 2
</code></pre>
<h4 id="2、基础框架-2"><a href="#2、基础框架-2" class="headerlink" title="2、基础框架"></a>2、基础框架</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;number[]&#125;</span> <span class="variable">nums</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;number&#125;</span> <span class="variable">k</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;number&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> numberOfSubarrays = <span class="function"><span class="keyword">function</span>(<span class="params">nums, k</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="3、原题链接-2"><a href="#3、原题链接-2" class="headerlink" title="3、原题链接"></a>3、原题链接</h4><blockquote>
<p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/count-number-of-nice-subarrays/">LeetCode 1248. 统计「优美子数组」</a></p>
</blockquote>
<h3 id="二、解题报告-2"><a href="#二、解题报告-2" class="headerlink" title="二、解题报告"></a>二、解题报告</h3><h4 id="1、思路分析-2"><a href="#1、思路分析-2" class="headerlink" title="1、思路分析"></a>1、思路分析</h4><p>用一个数组变量 count[ ] 来记录奇数个数有a个的连续子数组有count[a]个，用一个整数变量result来记录满足条件的子数组的个数，result的值是当前奇数个数与k值的比较，如果大于等于，则在result上添加count[odd-k]</p>
<h4 id="2、复杂度-1"><a href="#2、复杂度-1" class="headerlink" title="2、复杂度"></a>2、复杂度</h4><p>Time：O(n)</p>
<h4 id="3、代码详解-2"><a href="#3、代码详解-2" class="headerlink" title="3、代码详解"></a>3、代码详解</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;number[]&#125;</span> <span class="variable">nums</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;number&#125;</span> <span class="variable">k</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;number&#125;</span></span></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> numberOfSubarrays = <span class="function"><span class="keyword">function</span>(<span class="params">nums, k</span>) </span>&#123;</span><br><span class="line">    len = nums.length</span><br><span class="line">    <span class="keyword">let</span> count = <span class="keyword">new</span> <span class="built_in">Array</span>(len+<span class="number">1</span>).fill(<span class="number">0</span>)</span><br><span class="line">    count[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">    <span class="keyword">let</span> odd = <span class="number">0</span></span><br><span class="line">    <span class="keyword">let</span> result =<span class="number">0</span></span><br><span class="line">    nums.forEach(<span class="function">(<span class="params">value,index</span>)=&gt;</span>&#123;</span><br><span class="line">        odd+=value&amp;<span class="number">1</span></span><br><span class="line">        result += odd&gt;=k?count[odd-k]:<span class="number">0</span> <span class="comment">// 给前面留出odd-k个奇数，后面就有k个了</span></span><br><span class="line">        count[odd]++</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="三、本题小知识-2"><a href="#三、本题小知识-2" class="headerlink" title="三、本题小知识"></a>三、本题小知识</h3><pre><code>(1) x &amp; 1为 1 代表是奇数，否则是偶数；
(2) 计算前缀有多少个奇数；
</code></pre>
<h2 id="算法入门《线性枚举》简单01-——-LeetCode-344-反转字符串"><a href="#算法入门《线性枚举》简单01-——-LeetCode-344-反转字符串" class="headerlink" title="算法入门《线性枚举》简单01 —— LeetCode 344 反转字符串"></a><strong>算法入门</strong>《线性枚举》简单01 —— LeetCode 344 反转字符串</h2>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://mylym-mm.github.io/2021/09/19/17-16-00/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/hylike.jpg">
      <meta itemprop="name" content="lym">
      <meta itemprop="description" content="my的修炼之路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="my鱼">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/19/17-16-00/" class="post-title-link" itemprop="url">9.19-结构化拷贝</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-09-19 17:16:00 / Modified: 17:18:27" itemprop="dateCreated datePublished" datetime="2021-09-19T17:16:00+08:00">2021-09-19</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="结构化拷贝"><a href="#结构化拷贝" class="headerlink" title="结构化拷贝"></a>结构化拷贝</h1><p> 结构化拷贝 ：结构化克隆算法是<a target="_blank" rel="noopener" href="https://www.w3.org/html/wg/drafts/html/master/infrastructure.html#safe-passing-of-structured-data">由HTML5规范定义</a>的用于复制复杂JavaScript对象的算法。通过来自 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/Worker">Workers</a>的 <code>postMessage() </code>或使用 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Glossary/IndexedDB">IndexedDB</a> 存储对象时在内部使用。它通过递归输入对象来构建克隆，同时保持先前访问过的引用的映射，以避免无限遍历循环。</p>
<h6 id="结构化克隆算法"><a href="#结构化克隆算法" class="headerlink" title="结构化克隆算法"></a>结构化克隆算法</h6><p>结构化克隆算法是<a target="_blank" rel="noopener" href="https://www.w3.org/html/wg/drafts/html/master/infrastructure.html#safe-passing-of-structured-data">由HTML5规范定义</a>的用于复制复杂JavaScript对象的算法。通过来自 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/Worker">Workers</a>的 <code>postMessage() </code>或使用 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Glossary/IndexedDB">IndexedDB</a> 存储对象时在内部使用。它通过递归输入对象来构建克隆，同时保持先前访问过的引用的映射，以避免无限遍历循环。</p>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Structured_clone_algorithm#%E7%BB%93%E6%9E%84%E5%8C%96%E5%85%8B%E9%9A%86%E6%89%80%E4%B8%8D%E8%83%BD%E5%81%9A%E5%88%B0%E7%9A%84">结构化克隆所不能做到的</a></p>
<ul>
<li><strong><code>Error</code> 以及 <code>Function</code> 对象</strong>是不能被结构化克隆算法复制的；如果你尝试这样子去做，这会导致抛出 <code>DATA_CLONE_ERR</code> 的异常。</li>
<li>企图去克隆 <strong>DOM 节点</strong>同样会抛出 <code>DATA_CLONE_ERR</code> 异常。</li>
<li><strong>对象的某些特定参</strong>数也不会被保留  <ul>
<li><code>RegExp </code>对象的 <strong><code>lastIndex</code> 字段</strong>不会被保留</li>
<li>属性描述符，setters 以及 getters（以及其他类似元数据的功能）同样不会被复制。例如，如果一个对象用属性描述符标记为 read-only，它将会被复制为 read-write，因为这是默认的情况下。</li>
<li>原形链上的属性也不会被追踪以及复制。</li>
</ul>
</li>
</ul>
<h5 id="支持的类型"><a href="#支持的类型" class="headerlink" title="支持的类型"></a><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Structured_clone_algorithm#%E6%94%AF%E6%8C%81%E7%9A%84%E7%B1%BB%E5%9E%8B">支持的类型</a></h5><table>
<thead>
<tr>
<th>对象类型</th>
<th>注意</th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Data_structures#%E5%8E%9F%E5%A7%8B%E5%80%BC">所有的原始类型</a></td>
<td>symbols 除外</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean">Boolean</a> 对象</td>
<td></td>
</tr>
<tr>
<td>String 对象</td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Date">Date</a></td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/RegExp">RegExp</a></td>
<td><code>lastIndex</code> 字段不会被保留。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Blob"><code>Blob</code></a></td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/File"><code>File</code></a></td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/FileList"><code>FileList</code></a></td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer">ArrayBuffer</a></td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/TypedArray">ArrayBufferView</a></td>
<td>这基本上意味着所有的 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Typed_arrays">类型化数组</a> ，如 Int32Array 等。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/ImageData"><code>ImageData</code></a></td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array">Array</a></td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a></td>
<td>仅包括普通对象（如对象字面量）</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Map">Map</a></td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Set">Set</a></td>
<td></td>
</tr>
</tbody></table>
<h2 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Structured_clone_algorithm#%E7%9B%B8%E5%85%B3%E9%93%BE%E6%8E%A5">相关链接</a></h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.w3.org/TR/html5/infrastructure.html#safe-passing-of-structured-data">HTML5 Specification: Safe passing of structured data</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/history"><code>window.history</code></a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/postMessage"><code>window.postMessage()</code></a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API">Web Workers</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API">IndexedDB</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Components.utils.cloneInto">Components.utils.cloneInto</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://mylym-mm.github.io/2021/09/18/15-05-34/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/hylike.jpg">
      <meta itemprop="name" content="lym">
      <meta itemprop="description" content="my的修炼之路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="my鱼">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/18/15-05-34/" class="post-title-link" itemprop="url">git</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-09-18 15:05:34" itemprop="dateCreated datePublished" datetime="2021-09-18T15:05:34+08:00">2021-09-18</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-09-20 19:11:41" itemprop="dateModified" datetime="2021-09-20T19:11:41+08:00">2021-09-20</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="git"><a href="#git" class="headerlink" title="git"></a>git</h4><h5 id="git主要优点"><a href="#git主要优点" class="headerlink" title="git主要优点"></a>git主要优点</h5><ul>
<li>分布式存储，本地仓库包含了远程仓库的所有内容</li>
<li>安全性高，远程仓库文件丢失了也不怕</li>
<li>优秀的分支模型，创建/合并分支都非常快捷便捷</li>
</ul>
<h5 id="git分支管理"><a href="#git分支管理" class="headerlink" title="git分支管理"></a>git分支管理</h5><p>我们在实际工作中会创建很多分支以便于不同场景下的开发，但是如果没有分支规范就会造成分支杂乱，大家往往也搞不清楚一个分支是做什么，下面我们就介绍一下我们常用的并且推荐大家使用的分支类型。</p>
<h6 id="git分支类型"><a href="#git分支类型" class="headerlink" title="git分支类型"></a>git分支类型</h6><p>[master分支]</p>
<p>-master 为产品主分支，该分支为只读唯一分支，也是用于部署生产环境的分支，需确保master分支的稳定性。<br>-master 分支一般由 release 分支或 hotfix 分支合并，任何情况下都不应该直接修改master分支代码<br>-产品的功能全部实现后，最终在master分支对外发布，另外所有在 master 分支的推送应该打标签（tag）做记录，方便追溯。<br>-master 分支不可删除</p>
<p>develop 分支<br>-develop 为主开发分支，基于 master 分支创建，始终保持最新完成功能的代码以及bug修复后的代码<br>-develop 分支为只读唯一分支，只能从其他分支合并，不可以直接在该分支合并做功能开发或bug修复<br>-一般开发新功能时，feature 分支都是基于develop 分支下创建的。<br>-develop 分支包含所有要发布到下一个 release 的代码<br>-feature 功能分支完成后，开发人员需合并到develop分支（不推送远程），需先将develop分支合并到release分支，进行提测。<br>-当所有新功能开发完成后，开发人员需合并到develop分支（不推送远程），需要将develop 分支合并到 feature,解决完冲突后再合并到develop分支。<br>-当所有新功能开发完成后，开发人员并自测完成后，此时从develop拉取release分支，进行提测<br>-release或hotfix分支上线完成后 ，开发人员需合并到develop分支并推送远程<br>-develop分支不可删</p>
<p>feature分支<br>-feature 分支通常为新功能或新特性开发分支，以develop分支为基础创建feature分支<br>-分支命名： feature /开头的为新特性或新功能分支，建议的命名规则： feature/use_createtime_feature,例如：feature/ftd_20201018_alipay, 含义为：开发人员ftd在20201018创建了一个支付宝支付的功能分支。<br>-新特性或新功能开发完成后，开发人员需合并到develop分支<br>-feature 分支可同时存在多个，用于团队中多个功能同时开发<br>-feature分支属于临时分支，功能完成后可选删除</p>
<p>release 分支<br>-release 分支为预上线分支，基于本次上线所有的feature分支合并到develop分支之后，从develop分支创建<br>-分支命名： release/开头的为预上线分支，建议的命名规则：release/version_publishtime,例如：release/v2.1.1_20201018。<br>-release 分支主要用于提交给测试人员进行功能测试。发布提测阶段，会以release 分支代码为基准进行提测。测试过程中发现的bug在本分支进行修复，上线完成后需合并到develop/master分支并推送远程<br>-release 分支属于临时分支，产品上线后可选删除</p>
<p>“当有一组feature开发完成后，首先开发人员会各自将最新功能代码合并到develop分支。进入提测阶段时，开发组长在develop 分支上创建 release 分支。如果在测试过程中发现bug需要修复，则直接由开发者在release分支修复并提交。当测试完成后，开发组长将release分支合并到master和develop分支，此时master为最新可发布代码，用作产品发布上线”</p>
<p>hotfix 分支<br>-hotfix 分支为线上bug 修复分支或补丁分支，主要用于对线上的版本进行bug修复<br>-分支命名：hotfix/ 开发的为修复分支，他的命名规则与feature分支类似，建议的命名规则：hotfix/user_createtime_hotfix，例如：hotfix/ftd_20201018_alipaybugfix，含义为：开发人员ftd在20201018创建了一个支付宝支付bug修复的分支<br>-hotfix 分支用于线上出现紧急问题时，需要及时修复，以master分支为基线，创建hotfix分支。当问题修复完成后，需要合并到master分支和develop分支并推送远程。<br>-所有hotfix分支的修改会进入到下一个release。<br>-hotfix 分支属于临时分支，bug修复上线后可选删除。</p>
<h5 id="git日志规范"><a href="#git日志规范" class="headerlink" title="git日志规范"></a>git日志规范</h5><p>“在一个团队协作的项目中，开发人员需要经常提交一些代码去修复bug或者实现新的feature。而项目中的文件和实现什么功能、解决什么问题都会渐渐淡忘，最后需要浪费时间去阅读代码。但是好的日志规范commit message编写有帮助到我们，它也反映了一个开发人员是否是良好的协作者”</p>
<p>编写良好的Commit messages可以达到3个重要的目的：</p>
<ul>
<li>加快代码view的流程</li>
<li>帮助开发人员编写良好的版本发布日志</li>
<li>让之后的维护者了解代码里出现特定变化和feature被添加的原因</li>
</ul>
<p>「目前，社区有多种 Commit message 的写法规范。来自Angular 规范是目前使用最广的写法，比较合理和系统化。建议使用如下：」</p>
<p><strong>Commit messages的基本语法</strong></p>
<p>具体格式为:</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># EN</span><br><span class="line">&lt;type&gt;(&lt;scope&gt;): &lt;subject&gt;</span><br><span class="line">&lt;BLANK LINE&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;BLANK LINE&gt;</span><br><span class="line">&lt;footer&gt;</span><br><span class="line"># CN</span><br><span class="line">&lt;类型&gt;[可选的作用域]: &lt;描述&gt;</span><br><span class="line">[可选的正文]</span><br><span class="line">[可选的脚注]</span><br></pre></td></tr></table></figure>

<ul>
<li><p>type: 本次 commit 的类型，诸如 bugfix、docs、style 等，类型说明参见下方。</p>
</li>
<li><p>scope: 本次 commit 影响的范围，比如数据层、控制层、视图层等等，视项目不同而不同。</p>
</li>
<li><p>subject: 简明扼要的阐述下本次 commit 的主旨，是 commit 目的的简短描述，建议不超过50个字符。</p>
</li>
<li><p>body: 在主体内容中我们需要把本次 commit 详细的描述一下，比如此次变更的动机，详细的修改方法或其他需要额外重点说明的内容。</p>
</li>
<li><p>footer: 描述下与之关联的 issue 或 break change，详见案例。</p>
<h5 id="Type的类别说明："><a href="#Type的类别说明：" class="headerlink" title="Type的类别说明："></a><strong>Type的类别说明：</strong></h5></li>
</ul>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 主要type</span><br><span class="line">feat: 增加新功能</span><br><span class="line">fix: 修复bug</span><br><span class="line"> </span><br><span class="line"># 特殊type</span><br><span class="line">docs: 只改动了文档相关的内容</span><br><span class="line">style: 不影响代码含义的改动，例如去掉空格、改变缩进、增删分号</span><br><span class="line">build: 构造工具的或者外部依赖的改动，例如webpack，npm</span><br><span class="line">refactor: 代码重构时使用</span><br><span class="line">revert: 执行git revert打印的message</span><br><span class="line"> </span><br><span class="line"># 暂不使用type</span><br><span class="line">test: 添加测试或者修改现有测试</span><br><span class="line">perf: 提高性能的改动</span><br><span class="line">ci: 与CI（持续集成服务）有关的改动</span><br><span class="line">chore: 不修改src或者test的其余修改，例如构建过程或辅助工具的变动</span><br></pre></td></tr></table></figure>

<h5 id="Commit-messages格式要求"><a href="#Commit-messages格式要求" class="headerlink" title="Commit messages格式要求"></a><strong>Commit messages格式要求</strong></h5><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 标题行：50个字符以内，描述主要变更内容</span><br><span class="line">#</span><br><span class="line"># 主体内容：更详细的说明文本，建议72个字符以内。 需要描述的信息包括:</span><br><span class="line">#</span><br><span class="line"># * 为什么这个变更是必须的? 它可能是用来修复一个bug，增加一个feature，提升性能、可靠性、稳定性等等</span><br><span class="line"># * 如何解决这个问题? 具体描述解决问题的步骤</span><br><span class="line"># * 是否存在副作用、风险? </span><br><span class="line">#</span><br><span class="line"># 如果需要的话可以添加一个链接到issue地址或者其它文档</span><br></pre></td></tr></table></figure>

<p> <strong>示例：</strong></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># fix：修复支付宝支付bug</span><br><span class="line">#</span><br><span class="line"># 1，修复支付完成后未查询支付状态问题</span><br><span class="line"># 2，增加定时任务保证支付状态完整</span><br><span class="line">#</span><br><span class="line"># link：http://github.com/ftd/shopmall/issue001</span><br></pre></td></tr></table></figure>

<blockquote>
<p>❝ 注：如果一次改动内容较多，包含多个提交类型时，建议拆分成多个提交，分次提交，这样会更清晰。<br>❞</p>
</blockquote>
<h5 id="Git-Flow工作流"><a href="#Git-Flow工作流" class="headerlink" title="Git Flow工作流"></a><strong>Git Flow工作流</strong></h5><p>我们现在已经了解了Git的分支，包括分支有哪些类型，什么情况下使用什么类型的分支，以及提交的格式规范等。不过往往在一个团队人数较多，创建的分支也比较多的时候，还是会带来很多分支操作上的困扰。那有没有一个什么好的流程来规范大家呢，针对这些问题，建议大家使用Git Flow的工作流模式。</p>
<h5 id="Git-Flow-流程图"><a href="#Git-Flow-流程图" class="headerlink" title="Git Flow 流程图"></a><strong>Git Flow 流程图</strong></h5><h6 id="「1，主分支流程」"><a href="#「1，主分支流程」" class="headerlink" title="「1，主分支流程」"></a><strong>「1，主分支流程」</strong></h6><ul>
<li>master分支记录了每次版本发布历史和tag标记。</li>
<li>develop分支记录了所有开发的版本历史。</li>
<li>develop分支仅第一次创建时从master分支拉取。 </li>
</ul>
<p><img src="https://pic2.zhimg.com/v2-7d04bd950aa8e174f5bc0927d0dddf65_r.jpg"></p>
<h6 id="「2，开发流程」"><a href="#「2，开发流程」" class="headerlink" title="「2，开发流程」"></a><strong>「2，开发流程」</strong></h6><ul>
<li>feature分支是从develop分支拉取的分支。</li>
<li>每个feature完成后需合并到develop分支。 </li>
</ul>
<p><img src="https://pic2.zhimg.com/80/v2-4370d55e601c789c028041406034c635_720w.jpg"></p>
<h6 id="「3，提测发布流程」"><a href="#「3，提测发布流程」" class="headerlink" title="「3，提测发布流程」"></a><strong>「3，提测发布流程」</strong></h6><ul>
<li>release分支是在所有功能开发自测完成后，从develop分支拉取的分支。</li>
<li>release分支一旦创建后，通常不再从develop分支拉取，该分支只做bug修复，文档生成和其他面向发布的任务。</li>
<li>release分支测试完成，达到上线标准后，需合并回master分支和develop分支。 </li>
</ul>
<p><img src="https://pic2.zhimg.com/80/v2-34e42ecbcb3ed91086926bdf3857e4ad_720w.jpg"></p>
<h6 id="「4，bug修复流程」"><a href="#「4，bug修复流程」" class="headerlink" title="「4，bug修复流程」"></a><strong>「4，bug修复流程」</strong></h6><ul>
<li>hotfix分支是在线上出现bug之后，从master分支拉取的分支。</li>
<li>hotfix分支测试完成后，需合并回master分支和develop分支。 </li>
</ul>
<p><img src="https://pic1.zhimg.com/80/v2-70e259e69263b64222ee332a8678e498_720w.jpg"></p>
<h5 id="Git-Flow实战"><a href="#Git-Flow实战" class="headerlink" title="Git Flow实战"></a><strong>Git Flow实战</strong></h5><p>Git Flow的流程搞清楚后，我们下面开始实际的项目实战，假设我们现在有一个商城的项目，并且我们已经建好了Git仓库。</p>
<p>我们通过命令行和图形界面的方式分别向大家展示如何使用Git Flow工作流。</p>
<h5 id="Git-Flow-命令示例"><a href="#Git-Flow-命令示例" class="headerlink" title="Git Flow 命令示例"></a><strong>Git Flow 命令示例</strong></h5><h5 id="开始-Feature"><a href="#开始-Feature" class="headerlink" title="开始 Feature"></a><strong>开始 Feature</strong></h5><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 创建feature分支</span><br><span class="line">git flow feature start ftd_20201018_wechatpay</span><br><span class="line"></span><br><span class="line"># 指定当前分支pull的源为develop</span><br><span class="line">git branch --set-upstream-to=origin/develop feature/ftd_20201018_wechatpay</span><br></pre></td></tr></table></figure>

<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 发布feature</span><br><span class="line">git flow feature publish ftd_20201018_wechatpay</span><br><span class="line"></span><br><span class="line"># 完成feature</span><br><span class="line">git flow feature finish ftd_20201018_wechatpay</span><br><span class="line"></span><br><span class="line">开始 Release</span><br><span class="line">git flow release start v1.0_20201031</span><br><span class="line"></span><br><span class="line">完成 Release</span><br><span class="line">git flow release finish v1.0_20201031</span><br><span class="line"></span><br><span class="line">开始 Hotfix</span><br><span class="line">git flow hotfix start ftd_20201031_bugfix</span><br><span class="line"></span><br><span class="line">完成 Hotfix</span><br><span class="line">git flow hotfix finish ftd_20201031_bugfix</span><br></pre></td></tr></table></figure>

<p>大家可以看到，简简单单几行命令就可以完成比较复杂的流程管理，如果对于命令行不太擅长的小伙伴还可以使用图形工具，这里推荐使用sourcetree，sourcetree也是著名的Git管理工具，可以大大方便我们对Git的操作和使用，下面就来介绍一下sourcetree中如何使用Git Flow。（以下内容为Windows版本的sourcetree为例，Mac类似）</p>
<h3 id="初始化GitFlow"><a href="#初始化GitFlow" class="headerlink" title="初始化GitFlow"></a><strong>初始化GitFlow</strong></h3><p>打开sourcetree，选择想使用Git Flow工作流的项目，在右上角点击Git工作流按钮，如下图所示： </p>
<p><img src="https://pic3.zhimg.com/80/v2-8905db964ffa612296317a9572348dca_720w.jpg"></p>
<p>随后会弹出对话框，可以选择产品分支，开发分支以及功能分支等，如下图所示： </p>
<p>点击确定后完成仓库的Git Flow初始化。</p>
<h5 id="开始-Feature-1"><a href="#开始-Feature-1" class="headerlink" title="开始 Feature"></a><strong>开始 Feature</strong></h5><p>点击右上角Git工作流，显示如图界面： </p>
<p><img src="https://pic2.zhimg.com/80/v2-b6bf6c5cf942bddd9946868f0e7ec79d_720w.jpg"></p>
<p><img src="https://pic2.zhimg.com/80/v2-7daf41b5234c9efd19aef1addbc8d31d_720w.jpg"></p>
<p>输入本次功能的名称，点击确定创建feature分支 </p>
<p><img src="https://pic3.zhimg.com/80/v2-830ba50a587884e2ef94a9c954f37226_720w.jpg"></p>
<p>可以看到本地已经有了新建的feature分支，如图所示：</p>
<p><img src="https://pic4.zhimg.com/80/v2-432bf105f9c80df5c841ad423b9e1c6f_720w.jpg"></p>
<p>然后就可以在该分支进行功能开发了。</p>
<h5 id="完成-Feature"><a href="#完成-Feature" class="headerlink" title="完成 Feature"></a><strong>完成 Feature</strong></h5><p>功能开发完成之后，还是点击右上角Git工作流，显示如图界面： </p>
<p><img src="https://pic4.zhimg.com/80/v2-13ca7c5c6d1fe3619657f0e924ac6697_720w.jpg"></p>
<p>点击完成功能，如下图所示： </p>
<p><img src="https://pic4.zhimg.com/80/v2-2fa75372ae37b06f2da85fdcd2f929cf_720w.jpg"></p>
<p>这里可以选择将该feature分支删除或保留，可以根据团队的规定来处理即可。</p>
<p>点击确定后，完成feature功能的开发。</p>
<p>至此该流程处理完毕。</p>
<h5 id="开始-Release"><a href="#开始-Release" class="headerlink" title="开始 Release"></a><strong>开始 Release</strong></h5><p>同样的，点击右上角Git工作流，选择建立新的发布版本，显示如下： </p>
<p><img src="https://pic2.zhimg.com/80/v2-ed17790cb44fcac6caca7df237f4c955_720w.jpg"></p>
<p>输入发布版本名称，点击确定，完成release分支的创建。</p>
<p>此时可以看到已经创建的release分支，如下图所示： </p>
<p><img src="https://pic4.zhimg.com/80/v2-68c8331fe778adae2968f797787a43e7_720w.jpg"></p>
<h5 id="完成-Release"><a href="#完成-Release" class="headerlink" title="完成 Release"></a><strong>完成 Release</strong></h5><p>测试通过后，可以进行release版本的发布，如下图所示： </p>
<p><img src="https://pic1.zhimg.com/80/v2-27e3134ee9c2a53b5b82c800793cdfc4_720w.jpg"></p>
<p>输入该发布的标签信息，点击确定进行发布。</p>
<p>至此，我们已经完成了release的发布流程。</p>
<h5 id="Hotfix"><a href="#Hotfix" class="headerlink" title="Hotfix"></a><strong>Hotfix</strong></h5><p>hotfix流程与上述流程操作方法类似，再次不再赘述，大家可以通过软件进行操作练习。</p>
<h3 id="Git-使用规范流程"><a href="#Git-使用规范流程" class="headerlink" title="Git 使用规范流程"></a>Git 使用规范流程</h3><p>作者： <a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/">阮一峰</a></p>
<p>日期： <a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2015/08/">2015年8月 5日</a></p>
<p>团队开发中，遵循一个合理、清晰的Git使用流程，是非常重要的。</p>
<p>否则，每个人都提交一堆杂乱无章的commit，项目很快就会变得难以协调和维护。</p>
<p>下面是<a target="_blank" rel="noopener" href="https://github.com/thoughtbot/guides/tree/master/protocol/git">ThoughtBot</a> 的Git使用规范流程。我从中学到了很多，推荐你也这样使用Git。</p>
<p><img src="https://www.ruanyifeng.com/blogimg/asset/2015/bg2015080501.png"></p>
<h5 id="第一步：新建分支"><a href="#第一步：新建分支" class="headerlink" title="第一步：新建分支"></a>第一步：新建分支</h5><p>首先，每次开发新功能，都应该新建一个单独的分支（这方面可以参考<a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2012/07/git.html">《Git分支管理策略》</a>）。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取主干最新代码</span></span><br><span class="line">$ git checkout master</span><br><span class="line">$ git pull</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个开发分支myfeature</span></span><br><span class="line">$ git checkout -b myfeature</span><br></pre></td></tr></table></figure>
</blockquote>
<h5 id="第二步：提交分支commit"><a href="#第二步：提交分支commit" class="headerlink" title="第二步：提交分支commit"></a>第二步：提交分支commit</h5><p>分支修改后，就可以提交commit了。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git add --all</span><br><span class="line">$ git status</span><br><span class="line">$ git commit --verbose</span><br></pre></td></tr></table></figure>
</blockquote>
<p>git add 命令的all参数，表示保存所有变化（包括新建、修改和删除）。从Git 2.0开始，all是 git add 的默认参数，所以也可以用 git add . 代替。</p>
<p>git status 命令，用来查看发生变动的文件。</p>
<p>git commit 命令的verbose参数，会列出 <a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2012/08/how_to_read_diff.html">diff</a> 的结果。</p>
<h5 id="第三步：撰写提交信息"><a href="#第三步：撰写提交信息" class="headerlink" title="第三步：撰写提交信息"></a>第三步：撰写提交信息</h5><p>提交commit时，必须给出完整扼要的提交信息，下面是一个范本。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Present-tense summary under 50 characters</span><br><span class="line"></span><br><span class="line">* More information about commit (under 72 characters).</span><br><span class="line">* More information about commit (under 72 characters).</span><br><span class="line"></span><br><span class="line">http://project.management-system.com/ticket/123</span><br></pre></td></tr></table></figure>
</blockquote>
<p>第一行是不超过50个字的提要，然后空一行，罗列出改动原因、主要变动、以及需要注意的问题。最后，提供对应的网址（比如Bug ticket）。</p>
<h5 id="第四步：与主干同步"><a href="#第四步：与主干同步" class="headerlink" title="第四步：与主干同步"></a>第四步：与主干同步</h5><p>分支的开发过程中，要经常与主干保持同步。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git fetch origin</span><br><span class="line">$ git rebase origin/master</span><br></pre></td></tr></table></figure>

<h5 id="第五步：合并commit"><a href="#第五步：合并commit" class="headerlink" title="第五步：合并commit"></a>第五步：合并commit</h5><p>分支开发完成后，很可能有一堆commit，但是合并到主干的时候，往往希望只有一个（或最多两三个）commit，这样不仅清晰，也容易管理。</p>
<p>那么，怎样才能将多个commit合并呢？这就要用到 git rebase 命令。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git rebase -i origin/master</span><br></pre></td></tr></table></figure>
</blockquote>
<p>git rebase命令的i参数表示互动（interactive），这时git会打开一个互动界面，进行下一步操作。</p>
<p>下面采用<a target="_blank" rel="noopener" href="https://robots.thoughtbot.com/git-interactive-rebase-squash-amend-rewriting-history">Tute Costa</a>的例子，来解释怎么合并commit。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">pick 07c5abd Introduce OpenPGP and teach basic usage</span><br><span class="line">pick de9b1eb Fix PostChecker::Post<span class="comment">#urls</span></span><br><span class="line">pick 3e7ee36 Hey kids, stop all the highlighting</span><br><span class="line">pick fa20af3 git interactive rebase, squash, amend</span><br><span class="line"></span><br><span class="line"><span class="comment"># Rebase 8db7e8b..fa20af3 onto 8db7e8b</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Commands:</span></span><br><span class="line"><span class="comment">#  p, pick = use commit</span></span><br><span class="line"><span class="comment">#  r, reword = use commit, but edit the commit message</span></span><br><span class="line"><span class="comment">#  e, edit = use commit, but stop for amending</span></span><br><span class="line"><span class="comment">#  s, squash = use commit, but meld into previous commit</span></span><br><span class="line"><span class="comment">#  f, fixup = like &quot;squash&quot;, but discard this commit&#x27;s log message</span></span><br><span class="line"><span class="comment">#  x, exec = run command (the rest of the line) using shell</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># These lines can be re-ordered; they are executed from top to bottom.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If you remove a line here THAT COMMIT WILL BE LOST.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># However, if you remove everything, the rebase will be aborted.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Note that empty commits are commented out</span></span><br></pre></td></tr></table></figure>

<p>上面的互动界面，先列出当前分支最新的4个commit（越下面越新）。每个commit前面有一个操作命令，默认是pick，表示该行commit被选中，要进行rebase操作。</p>
<p>4个commit的下面是一大堆注释，列出可以使用的命令。</p>
<blockquote>
<ul>
<li>pick：正常选中</li>
<li>reword：选中，并且修改提交信息；</li>
<li>edit：选中，rebase时会暂停，允许你修改这个commit（参考<a target="_blank" rel="noopener" href="https://schacon.github.io/gitbook/4_interactive_rebasing.html">这里</a>）</li>
<li>squash：选中，会将当前commit与上一个commit合并</li>
<li>fixup：与squash相同，但不会保存当前commit的提交信息</li>
<li>exec：执行其他shell命令</li>
</ul>
</blockquote>
<p>上面这6个命令当中，squash和fixup可以用来合并commit。先把需要合并的commit前面的动词，改成squash（或者s）。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pick 07c5abd Introduce OpenPGP and teach basic usage</span><br><span class="line">s de9b1eb Fix PostChecker::Post<span class="comment">#urls</span></span><br><span class="line">s 3e7ee36 Hey kids, stop all the highlighting</span><br><span class="line">pick fa20af3 git interactive rebase, squash, amend</span><br></pre></td></tr></table></figure>
</blockquote>
<p>这样一改，执行后，当前分支只会剩下两个commit。第二行和第三行的commit，都会合并到第一行的commit。提交信息会同时包含，这三个commit的提交信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># This is a combination of 3 commits.</span></span><br><span class="line"><span class="comment"># The first commit&#x27;s message is:</span></span><br><span class="line">Introduce OpenPGP and teach basic usage</span><br><span class="line"></span><br><span class="line"><span class="comment"># This is the 2nd commit message:</span></span><br><span class="line">Fix PostChecker::Post<span class="comment">#urls</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># This is the 3rd commit message:</span></span><br><span class="line">Hey kids, stop all the highlighting</span><br></pre></td></tr></table></figure>

<p>如果将第三行的squash命令改成fixup命令。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pick 07c5abd Introduce OpenPGP and teach basic usage</span><br><span class="line">s de9b1eb Fix PostChecker::Post<span class="comment">#urls</span></span><br><span class="line">f 3e7ee36 Hey kids, stop all the highlighting</span><br><span class="line">pick fa20af3 git interactive rebase, squash, amend</span><br></pre></td></tr></table></figure>
</blockquote>
<p>运行结果相同，还是会生成两个commit，第二行和第三行的commit，都合并到第一行的commit。但是，新的提交信息里面，第三行commit的提交信息，会被注释掉。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># This is a combination of 3 commits.</span></span><br><span class="line"><span class="comment"># The first commit&#x27;s message is:</span></span><br><span class="line">Introduce OpenPGP and teach basic usage</span><br><span class="line"></span><br><span class="line"><span class="comment"># This is the 2nd commit message:</span></span><br><span class="line">Fix PostChecker::Post<span class="comment">#urls</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># This is the 3rd commit message:</span></span><br><span class="line"><span class="comment"># Hey kids, stop all the highlighting</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://ponyfoo.com/articles/git-github-hacks">Pony Foo</a>提出另外一种合并commit的简便方法，就是先撤销过去5个commit，然后再建一个新的。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git reset HEAD~5</span><br><span class="line">$ git add .</span><br><span class="line">$ git commit -am <span class="string">&quot;Here&#x27;s the bug fix that closes #28&quot;</span></span><br><span class="line">$ git push --force</span><br></pre></td></tr></table></figure>
</blockquote>
<p>squash和fixup命令，还可以当作命令行参数使用，自动合并commit。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git commit --fixup  </span><br><span class="line">$ git rebase -i --autosquash </span><br></pre></td></tr></table></figure>
</blockquote>
<p>这个用法请参考<a target="_blank" rel="noopener" href="https://fle.github.io/git-tip-keep-your-branch-clean-with-fixup-and-autosquash.html">这篇文章</a>，这里就不解释了。</p>
<h5 id="第六步：推送到远程仓库"><a href="#第六步：推送到远程仓库" class="headerlink" title="第六步：推送到远程仓库"></a>第六步：推送到远程仓库</h5><p>合并commit后，就可以推送当前分支到远程仓库了。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push --force origin myfeature</span><br></pre></td></tr></table></figure>
</blockquote>
<p>git push命令要加上force参数，因为rebase以后，分支历史改变了，跟远程分支不一定兼容，有可能要强行推送（参见<a target="_blank" rel="noopener" href="http://willi.am/blog/2014/08/12/the-dark-side-of-the-force-push/">这里</a>）。</p>
<h5 id="第七步：发出Pull-Request"><a href="#第七步：发出Pull-Request" class="headerlink" title="第七步：发出Pull Request"></a>第七步：发出Pull Request</h5><p>提交到远程仓库以后，就可以发出 Pull Request 到master分支，然后请求别人进行代码review，确认可以合并到master。</p>
<h3 id="常用-Git-命令清单"><a href="#常用-Git-命令清单" class="headerlink" title="常用 Git 命令清单"></a>常用 Git 命令清单</h3><p>作者： <a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/">阮一峰</a></p>
<p>我每天使用 Git ，但是很多命令记不住。</p>
<p>一般来说，日常使用只要记住下图6个命令，就可以了。但是熟练使用，恐怕要记住60～100个命令。</p>
<p><img src="https://www.ruanyifeng.com/blogimg/asset/2015/bg2015120901.png"></p>
<h5 id=""><a href="#" class="headerlink" title=""></a></h5><p>下面是我整理的常用 Git 命令清单。几个专用名词的译名如下。</p>
<blockquote>
<ul>
<li>Workspace：工作区</li>
<li>Index / Stage：暂存区</li>
<li>Repository：仓库区（或本地仓库）</li>
<li>Remote：远程仓库</li>
</ul>
</blockquote>
<h5 id="一、新建代码库"><a href="#一、新建代码库" class="headerlink" title="一、新建代码库"></a>一、新建代码库</h5><blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在当前目录新建一个Git代码库</span></span><br><span class="line">$ git init</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个目录，将其初始化为Git代码库</span></span><br><span class="line">$ git init [project-name]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载一个项目和它的整个代码历史</span></span><br><span class="line">$ git <span class="built_in">clone</span> [url]</span><br></pre></td></tr></table></figure>
</blockquote>
<h5 id="二、配置"><a href="#二、配置" class="headerlink" title="二、配置"></a>二、配置</h5><p>Git的设置文件为<code>.gitconfig</code>，它可以在用户主目录下（全局配置），也可以在项目目录下（项目配置）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示当前的Git配置</span></span><br><span class="line">$ git config --list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编辑Git配置文件</span></span><br><span class="line">$ git config -e [--global]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置提交代码时的用户信息</span></span><br><span class="line">$ git config [--global] user.name <span class="string">&quot;[name]&quot;</span></span><br><span class="line">$ git config [--global] user.email <span class="string">&quot;[email address]&quot;</span></span><br></pre></td></tr></table></figure>

<h5 id="三、增加-删除文件"><a href="#三、增加-删除文件" class="headerlink" title="三、增加/删除文件"></a>三、增加/删除文件</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加指定文件到暂存区</span></span><br><span class="line">$ git add [file1] [file2] ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加指定目录到暂存区，包括子目录</span></span><br><span class="line">$ git add [dir]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加当前目录的所有文件到暂存区</span></span><br><span class="line">$ git add .</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加每个变化前，都会要求确认</span></span><br><span class="line"><span class="comment"># 对于同一个文件的多处变化，可以实现分次提交</span></span><br><span class="line">$ git add -p</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除工作区文件，并且将这次删除放入暂存区</span></span><br><span class="line">$ git rm [file1] [file2] ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止追踪指定文件，但该文件会保留在工作区</span></span><br><span class="line">$ git rm --cached [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 改名文件，并且将这个改名放入暂存区</span></span><br><span class="line">$ git mv [file-original] [file-renamed]</span><br></pre></td></tr></table></figure>

<h5 id="四、代码提交"><a href="#四、代码提交" class="headerlink" title="四、代码提交"></a>四、代码提交</h5><blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 提交暂存区到仓库区</span></span><br><span class="line">$ git commit -m [message]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交暂存区的指定文件到仓库区</span></span><br><span class="line">$ git commit [file1] [file2] ... -m [message]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交工作区自上次commit之后的变化，直接到仓库区</span></span><br><span class="line">$ git commit -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交时显示所有diff信息</span></span><br><span class="line">$ git commit -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用一次新的commit，替代上一次提交</span></span><br><span class="line"><span class="comment"># 如果代码没有任何新变化，则用来改写上一次commit的提交信息</span></span><br><span class="line">$ git commit --amend -m [message]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重做上一次commit，并包括指定文件的新变化</span></span><br><span class="line">$ git commit --amend [file1] [file2] ...</span><br></pre></td></tr></table></figure>
</blockquote>
<h5 id="五、分支"><a href="#五、分支" class="headerlink" title="五、分支"></a>五、分支</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列出所有本地分支</span></span><br><span class="line">$ git branch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出所有远程分支</span></span><br><span class="line">$ git branch -r</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出所有本地分支和远程分支</span></span><br><span class="line">$ git branch -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个分支，但依然停留在当前分支</span></span><br><span class="line">$ git branch [branch-name]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个分支，并切换到该分支</span></span><br><span class="line">$ git checkout -b [branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个分支，指向指定commit</span></span><br><span class="line">$ git branch [branch] [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个分支，与指定的远程分支建立追踪关系</span></span><br><span class="line">$ git branch --track [branch] [remote-branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换到指定分支，并更新工作区</span></span><br><span class="line">$ git checkout [branch-name]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换到上一个分支</span></span><br><span class="line">$ git checkout -</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立追踪关系，在现有分支与指定的远程分支之间</span></span><br><span class="line">$ git branch --set-upstream [branch] [remote-branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 合并指定分支到当前分支</span></span><br><span class="line">$ git merge [branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择一个commit，合并进当前分支</span></span><br><span class="line">$ git cherry-pick [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除分支</span></span><br><span class="line">$ git branch -d [branch-name]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除远程分支</span></span><br><span class="line">$ git push origin --delete [branch-name]</span><br><span class="line">$ git branch -dr [remote/branch]</span><br></pre></td></tr></table></figure>

<h5 id="六、标签"><a href="#六、标签" class="headerlink" title="六、标签"></a>六、标签</h5><blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列出所有tag</span></span><br><span class="line">$ git tag</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个tag在当前commit</span></span><br><span class="line">$ git tag [tag]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个tag在指定commit</span></span><br><span class="line">$ git tag [tag] [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除本地tag</span></span><br><span class="line">$ git tag -d [tag]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除远程tag</span></span><br><span class="line">$ git push origin :refs/tags/[tagName]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看tag信息</span></span><br><span class="line">$ git show [tag]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交指定tag</span></span><br><span class="line">$ git push [remote] [tag]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交所有tag</span></span><br><span class="line">$ git push [remote] --tags</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个分支，指向某个tag</span></span><br><span class="line">$ git checkout -b [branch] [tag]</span><br></pre></td></tr></table></figure>
</blockquote>
<h5 id="七、查看信息"><a href="#七、查看信息" class="headerlink" title="七、查看信息"></a>七、查看信息</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示有变更的文件</span></span><br><span class="line">$ git status</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示当前分支的版本历史</span></span><br><span class="line">$ git <span class="built_in">log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示commit历史，以及每次commit发生变更的文件</span></span><br><span class="line">$ git <span class="built_in">log</span> --<span class="built_in">stat</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 搜索提交历史，根据关键词</span></span><br><span class="line">$ git <span class="built_in">log</span> -S [keyword]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某个commit之后的所有变动，每个commit占据一行</span></span><br><span class="line">$ git <span class="built_in">log</span> [tag] HEAD --pretty=format:%s</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某个commit之后的所有变动，其&quot;提交说明&quot;必须符合搜索条件</span></span><br><span class="line">$ git <span class="built_in">log</span> [tag] HEAD --grep feature</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某个文件的版本历史，包括文件改名</span></span><br><span class="line">$ git <span class="built_in">log</span> --follow [file]</span><br><span class="line">$ git whatchanged [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示指定文件相关的每一次diff</span></span><br><span class="line">$ git <span class="built_in">log</span> -p [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示过去5次提交</span></span><br><span class="line">$ git <span class="built_in">log</span> -5 --pretty --oneline</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示所有提交过的用户，按提交次数排序</span></span><br><span class="line">$ git shortlog -sn</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示指定文件是什么人在什么时间修改过</span></span><br><span class="line">$ git blame [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示暂存区和工作区的差异</span></span><br><span class="line">$ git diff</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示暂存区和上一个commit的差异</span></span><br><span class="line">$ git diff --cached [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示工作区与当前分支最新commit之间的差异</span></span><br><span class="line">$ git diff HEAD</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示两次提交之间的差异</span></span><br><span class="line">$ git diff [first-branch]...[second-branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示今天你写了多少行代码</span></span><br><span class="line">$ git diff --shortstat <span class="string">&quot;@&#123;0 day ago&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某次提交的元数据和内容变化</span></span><br><span class="line">$ git show [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某次提交发生变化的文件</span></span><br><span class="line">$ git show --name-only [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某次提交时，某个文件的内容</span></span><br><span class="line">$ git show [commit]:[filename]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示当前分支的最近几次提交</span></span><br><span class="line">$ git reflog</span><br></pre></td></tr></table></figure>

<h5 id="八、远程同步"><a href="#八、远程同步" class="headerlink" title="八、远程同步"></a>八、远程同步</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载远程仓库的所有变动</span></span><br><span class="line">$ git fetch [remote]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示所有远程仓库</span></span><br><span class="line">$ git remote -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某个远程仓库的信息</span></span><br><span class="line">$ git remote show [remote]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 增加一个新的远程仓库，并命名</span></span><br><span class="line">$ git remote add [shortname] [url]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 取回远程仓库的变化，并与本地分支合并</span></span><br><span class="line">$ git pull [remote] [branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上传本地指定分支到远程仓库</span></span><br><span class="line">$ git push [remote] [branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 强行推送当前分支到远程仓库，即使有冲突</span></span><br><span class="line">$ git push [remote] --force</span><br><span class="line"></span><br><span class="line"><span class="comment"># 推送所有分支到远程仓库</span></span><br><span class="line">$ git push [remote] --all</span><br></pre></td></tr></table></figure>

<h5 id="九、撤销"><a href="#九、撤销" class="headerlink" title="九、撤销"></a>九、撤销</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 恢复暂存区的指定文件到工作区</span></span><br><span class="line">$ git checkout [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 恢复某个commit的指定文件到暂存区和工作区</span></span><br><span class="line">$ git checkout [commit] [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 恢复暂存区的所有文件到工作区</span></span><br><span class="line">$ git checkout .</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重置暂存区的指定文件，与上一次commit保持一致，但工作区不变</span></span><br><span class="line">$ git reset [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重置暂存区与工作区，与上一次commit保持一致</span></span><br><span class="line">$ git reset --hard</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重置当前分支的指针为指定commit，同时重置暂存区，但工作区不变</span></span><br><span class="line">$ git reset [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重置当前分支的HEAD为指定commit，同时重置暂存区和工作区，与指定commit一致</span></span><br><span class="line">$ git reset --hard [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重置当前HEAD为指定commit，但保持暂存区和工作区不变</span></span><br><span class="line">$ git reset --keep [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个commit，用来撤销指定commit</span></span><br><span class="line"><span class="comment"># 后者的所有变化都将被前者抵消，并且应用到当前分支</span></span><br><span class="line">$ git revert [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 暂时将未提交的变化移除，稍后再移入</span></span><br><span class="line">$ git stash</span><br><span class="line">$ git stash pop</span><br></pre></td></tr></table></figure>

<h5 id="十、其他"><a href="#十、其他" class="headerlink" title="十、其他"></a>十、其他</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成一个可供发布的压缩包</span></span><br><span class="line">$ git archive</span><br></pre></td></tr></table></figure>



<h2 id="Git-工作流程"><a href="#Git-工作流程" class="headerlink" title="Git 工作流程"></a>Git 工作流程</h2><p>作者： <a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/">阮一峰</a></p>
<p>日期： <a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2015/12/">2015年12月24日</a></p>
<p>Git 作为一个源码管理系统，不可避免涉及到多人协作。</p>
<p>协作必须有一个规范的工作流程，让大家有效地合作，使得项目井井有条地发展下去。”工作流程”在英语里，叫做”workflow”或者”flow”，原意是水流，比喻项目像水流那样，顺畅、自然地向前流动，不会发生冲击、对撞、甚至漩涡。</p>
<p><img src="https://www.ruanyifeng.com/blogimg/asset/2015/bg2015122301.png" alt="img"></p>
<p>本文介绍三种广泛使用的工作流程：</p>
<blockquote>
<ul>
<li>Git flow</li>
<li>Github flow</li>
<li>Gitlab flow</li>
</ul>
</blockquote>
<p>如果你对Git还不是很熟悉，可以先阅读下面的文章。</p>
<blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2015/08/git-use-process.html">《Git 使用规范流程》</a></li>
<li><a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2015/12/git-cheat-sheet.html">《常用 Git 命令清单》</a></li>
<li><a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2014/06/git_remote.html">《Git 远程操作详解》</a></li>
</ul>
</blockquote>
<h3 id="一、功能驱动"><a href="#一、功能驱动" class="headerlink" title="一、功能驱动"></a>一、功能驱动</h3><p>本文的三种工作流程，有一个共同点：都采用<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Feature-driven_development">“功能驱动式开发”</a>（Feature-driven development，简称FDD）。</p>
<p>它指的是，需求是开发的起点，先有需求再有功能分支（feature branch）或者补丁分支（hotfix branch）。完成开发后，该分支就合并到主分支，然后被删除。</p>
<h3 id="二、Git-flow"><a href="#二、Git-flow" class="headerlink" title="二、Git flow"></a>二、Git flow</h3><p>最早诞生、并得到广泛采用的一种工作流程，就是<a target="_blank" rel="noopener" href="http://nvie.com/posts/a-successful-git-branching-model/">Git flow</a> 。</p>
<h4 id="2-1-特点"><a href="#2-1-特点" class="headerlink" title="2.1 特点"></a>2.1 特点</h4><p>它最主要的特点有两个。</p>
<p><img src="https://www.ruanyifeng.com/blogimg/asset/2015/bg2015122302.png" alt="img"></p>
<p>首先，项目存在两个长期分支。</p>
<blockquote>
<ul>
<li>主分支<code>master</code></li>
<li>开发分支<code>develop</code></li>
</ul>
</blockquote>
<p>前者用于存放对外发布的版本，任何时候在这个分支拿到的，都是稳定的分布版；后者用于日常开发，存放最新的开发版。</p>
<p>其次，项目存在三种短期分支。</p>
<blockquote>
<ul>
<li>功能分支（feature branch）</li>
<li>补丁分支（hotfix branch）</li>
<li>预发分支（release branch）</li>
</ul>
</blockquote>
<p>一旦完成开发，它们就会被合并进<code>develop</code>或<code>master</code>，然后被删除。</p>
<p>Git flow 的详细介绍，请阅读我翻译的中文版<a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2012/07/git.html">《Git 分支管理策略》</a>。</p>
<h4 id="2-2-评价"><a href="#2-2-评价" class="headerlink" title="2.2 评价"></a>2.2 评价</h4><p>Git flow的优点是清晰可控，缺点是相对复杂，需要同时维护两个长期分支。大多数工具都将<code>master</code>当作默认分支，可是开发是在<code>develop</code>分支进行的，这导致经常要切换分支，非常烦人。</p>
<p>更大问题在于，这个模式是基于”版本发布”的，目标是一段时间以后产出一个新版本。但是，很多网站项目是”持续发布”，代码一有变动，就部署一次。这时，<code>master</code>分支和<code>develop</code>分支的差别不大，没必要维护两个长期分支。</p>
<h3 id="三、Github-flow"><a href="#三、Github-flow" class="headerlink" title="三、Github flow"></a>三、Github flow</h3><p><a target="_blank" rel="noopener" href="http://scottchacon.com/2011/08/31/github-flow.html">Github flow</a> 是Git flow的简化版，专门配合”持续发布”。它是 Github.com 使用的工作流程。</p>
<h4 id="3-1-流程"><a href="#3-1-流程" class="headerlink" title="3.1 流程"></a>3.1 流程</h4><p>它只有一个长期分支，就是<code>master</code>，因此用起来非常简单。</p>
<p>官方推荐的<a target="_blank" rel="noopener" href="https://guides.github.com/introduction/flow/index.html">流程</a>如下。</p>
<p><img src="https://www.ruanyifeng.com/blogimg/asset/2015/bg2015122305.png" alt="img"></p>
<blockquote>
<p>第一步：根据需求，从<code>master</code>拉出新分支，不区分功能分支或补丁分支。</p>
<p>第二步：新分支开发完成后，或者需要讨论的时候，就向<code>master</code>发起一个<a target="_blank" rel="noopener" href="https://help.github.com/articles/using-pull-requests/">pull request</a>（简称PR）。</p>
<p>第三步：Pull Request既是一个通知，让别人注意到你的请求，又是一种对话机制，大家一起评审和讨论你的代码。对话过程中，你还可以不断提交代码。</p>
<p>第四步：你的Pull Request被接受，合并进<code>master</code>，重新部署后，原来你拉出来的那个分支就被删除。（先部署再合并也可。）</p>
</blockquote>
<h4 id="3-2-评价"><a href="#3-2-评价" class="headerlink" title="3.2 评价"></a>3.2 评价</h4><p>Github flow 的最大优点就是简单，对于”持续发布”的产品，可以说是最合适的流程。</p>
<p>问题在于它的假设：<code>master</code>分支的更新与产品的发布是一致的。也就是说，<code>master</code>分支的最新代码，默认就是当前的线上代码。</p>
<p>可是，有些时候并非如此，代码合并进入<code>master</code>分支，并不代表它就能立刻发布。比如，苹果商店的APP提交审核以后，等一段时间才能上架。这时，如果还有新的代码提交，<code>master</code>分支就会与刚发布的版本不一致。另一个例子是，有些公司有发布窗口，只有指定时间才能发布，这也会导致线上版本落后于<code>master</code>分支。</p>
<p>上面这种情况，只有<code>master</code>一个主分支就不够用了。通常，你不得不在<code>master</code>分支以外，另外新建一个<code>production</code>分支跟踪线上版本。</p>
<h3 id="四、Gitlab-flow"><a href="#四、Gitlab-flow" class="headerlink" title="四、Gitlab flow"></a>四、Gitlab flow</h3><p><a target="_blank" rel="noopener" href="https://docs.gitlab.com/ee/workflow/gitlab_flow.html">Gitlab flow</a> 是 Git flow 与 Github flow 的综合。它吸取了两者的优点，既有适应不同开发环境的弹性，又有单一主分支的简单和便利。它是 Gitlab.com 推荐的做法。</p>
<h4 id="4-1-上游优先"><a href="#4-1-上游优先" class="headerlink" title="4.1 上游优先"></a>4.1 上游优先</h4><p>Gitlab flow 的最大原则叫做”上游优先”（upsteam first），即只存在一个主分支<code>master</code>，它是所有其他分支的”上游”。只有上游分支采纳的代码变化，才能应用到其他分支。</p>
<p><a target="_blank" rel="noopener" href="https://www.chromium.org/chromium-os/chromiumos-design-docs/upstream-first">Chromium项目</a>就是一个例子，它明确规定，上游分支依次为：</p>
<blockquote>
<ol>
<li>Linus Torvalds的分支</li>
<li>子系统（比如netdev）的分支</li>
<li>设备厂商（比如三星）的分支</li>
</ol>
</blockquote>
<h4 id="4-2-持续发布"><a href="#4-2-持续发布" class="headerlink" title="4.2 持续发布"></a>4.2 持续发布</h4><p>Gitlab flow 分成两种情况，适应不同的开发流程。</p>
<p><img src="https://www.ruanyifeng.com/blogimg/asset/2015/bg2015122306.png" alt="img"></p>
<p>对于”持续发布”的项目，它建议在<code>master</code>分支以外，再建立不同的环境分支。比如，”开发环境”的分支是<code>master</code>，”预发环境”的分支是<code>pre-production</code>，”生产环境”的分支是<code>production</code>。</p>
<p>开发分支是预发分支的”上游”，预发分支又是生产分支的”上游”。代码的变化，必须由”上游”向”下游”发展。比如，生产环境出现了bug，这时就要新建一个功能分支，先把它合并到<code>master</code>，确认没有问题，再<code>cherry-pick</code>到<code>pre-production</code>，这一步也没有问题，才进入<code>production</code>。</p>
<p>只有紧急情况，才允许跳过上游，直接合并到下游分支。</p>
<h4 id="4-3-版本发布"><a href="#4-3-版本发布" class="headerlink" title="4.3 版本发布"></a>4.3 版本发布</h4><p><img src="https://www.ruanyifeng.com/blogimg/asset/2015/bg2015122307.png" alt="img"></p>
<p>对于”版本发布”的项目，建议的做法是每一个稳定版本，都要从<code>master</code>分支拉出一个分支，比如<code>2-3-stable</code>、<code>2-4-stable</code>等等。</p>
<p>以后，只有修补bug，才允许将代码合并到这些分支，并且此时要更新小版本号。</p>
<h3 id="五、一些小技巧"><a href="#五、一些小技巧" class="headerlink" title="五、一些小技巧"></a>五、一些小技巧</h3><h4 id="5-1-Pull-Request"><a href="#5-1-Pull-Request" class="headerlink" title="5.1 Pull Request"></a>5.1 Pull Request</h4><p><img src="https://www.ruanyifeng.com/blogimg/asset/2015/bg2015122310.png" alt="img"></p>
<p>功能分支合并进<code>master</code>分支，必须通过Pull Request（Gitlab里面叫做 Merge Request）。</p>
<p><img src="https://www.ruanyifeng.com/blogimg/asset/2015/bg2015122308.png" alt="img"></p>
<p>前面说过，Pull Request本质是一种对话机制，你可以在提交的时候，<code>@</code>相关<a target="_blank" rel="noopener" href="https://github.com/blog/1004-mention-autocompletion">人员</a>或<a target="_blank" rel="noopener" href="https://github.com/blog/1121-introducing-team-mentions">团队</a>，引起他们的注意。</p>
<h4 id="5-2-Protected-branch"><a href="#5-2-Protected-branch" class="headerlink" title="5.2 Protected branch"></a>5.2 Protected branch</h4><p><code>master</code>分支应该受到保护，不是每个人都可以修改这个分支，以及拥有审批 Pull Request 的权力。</p>
<p><a target="_blank" rel="noopener" href="https://help.github.com/articles/about-protected-branches/">Github</a> 和 <a target="_blank" rel="noopener" href="https://docs.gitlab.com/ce/permissions/permissions.html">Gitlab</a> 都提供”保护分支”（Protected branch）这个功能。</p>
<h4 id="5-3-Issue"><a href="#5-3-Issue" class="headerlink" title="5.3 Issue"></a>5.3 Issue</h4><p>Issue 用于 Bug追踪和需求管理。建议先新建 Issue，再新建对应的功能分支。功能分支总是为了解决一个或多个 Issue。</p>
<p>功能分支的名称，可以与issue的名字保持一致，并且以issue的编号起首，比如”15-require-a-password-to-change-it”。</p>
<p><img src="https://www.ruanyifeng.com/blogimg/asset/2015/bg2015122311.png" alt="img"></p>
<p>开发完成后，在提交说明里面，可以写上”fixes #14”或者”closes #67”。Github规定，只要commit message里面有下面这些<a target="_blank" rel="noopener" href="https://help.github.com/articles/closing-issues-via-commit-messages/">动词</a> + 编号，就会关闭对应的issue。</p>
<blockquote>
<ul>
<li>close</li>
<li>closes</li>
<li>closed</li>
<li>fix</li>
<li>fixes</li>
<li>fixed</li>
<li>resolve</li>
<li>resolves</li>
<li>resolved</li>
</ul>
</blockquote>
<p>这种方式还可以一次关闭多个issue，或者关闭其他代码库的issue，格式是<code>username/repository#issue_number</code>。</p>
<p>Pull Request被接受以后，issue关闭，原始分支就应该删除。如果以后该issue重新打开，新分支可以复用原来的名字。</p>
<h4 id="5-4-Merge节点"><a href="#5-4-Merge节点" class="headerlink" title="5.4 Merge节点"></a>5.4 Merge节点</h4><p>Git有两种合并：一种是”直进式合并”（fast forward），不生成单独的合并节点；另一种是”非直进式合并”（none fast-forword），会生成单独节点。</p>
<p>前者不利于保持commit信息的清晰，也不利于以后的回滚，建议总是采用后者（即使用<code>--no-ff</code>参数）。只要发生合并，就要有一个单独的合并节点。</p>
<h4 id="5-5-Squash-多个commit"><a href="#5-5-Squash-多个commit" class="headerlink" title="5.5 Squash 多个commit"></a>5.5 Squash 多个commit</h4><p>为了便于他人阅读你的提交，也便于<code>cherry-pick</code>或撤销代码变化，在发起Pull Request之前，应该把多个commit合并成一个。（前提是，该分支只有你一个人开发，且没有跟<code>master</code>合并过。）</p>
<p><img src="https://www.ruanyifeng.com/blogimg/asset/2015/bg2015122309.png" alt="img"></p>
<p>这可以采用<code>rebase</code>命令附带的<code>squash</code>操作，具体方法请参考我写的<a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2015/08/git-use-process.html">《Git 使用规范流程》</a>。</p>
<h2 id="git如果出现冲突怎么办"><a href="#git如果出现冲突怎么办" class="headerlink" title="git如果出现冲突怎么办 ?"></a>git如果出现冲突怎么办 ?</h2><h3 id="git冲突解决"><a href="#git冲突解决" class="headerlink" title="git冲突解决"></a>git冲突解决</h3><h4 id="1-简单分支管理的冲突解决："><a href="#1-简单分支管理的冲突解决：" class="headerlink" title="1.简单分支管理的冲突解决："></a>1.简单分支管理的冲突解决：</h4><p>当我们在master和feature1两个分支上都对同一个文件进行了修改提交后，现在我们要合并分支，这时git无法进行快速合并，可能会有冲突，我们可以使用git status 查看也可以直接查看文件（git 会自动标识 ） </p>
<p><img src="https://upload-images.jianshu.io/upload_images/2494440-ff788275fd8b47c5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/455" alt="img"></p>
<p>​                                                                    冲突示意图</p>
<p>解决办法：</p>
<p>A.在文件中选择一个版本保留，删除有冲突不需要保存的部分内容后，保存文件</p>
<p>B.再次提交</p>
<p>C.删除feature1分支</p>
<p><img src="https://upload-images.jianshu.io/upload_images/2494440-5b4d691285746444.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/561" alt="img"></p>
<p>​                                                            解决冲突后的分支图</p>
<p>注：可用git log–graph命令可以看到分支合并图。</p>
<h4 id="2-多人协作时的冲突解决"><a href="#2-多人协作时的冲突解决" class="headerlink" title="2.多人协作时的冲突解决"></a>2.多人协作时的冲突解决</h4><p>当你的小伙伴将本地dev上的一个文件push到origin/dev上后，而碰巧你也修改了同一个文件打算push到远程，但此时会和你的小伙伴的提交有冲突。</p>
<p>解决办法：</p>
<p>A.用git pull 把最新的提交从origin/dev上拉取下来（第一次pull可能会失败，git可能会提示你没有指定本地的dev和origin/dev 的链接，一般根据提示采用 $git branch –set-upstream dev origin/dev建立链接，再次使用git pull）</p>
<p>B.现在你已经成功的拉取了远程最新的提交，但是合并有冲突，需要像上一例中手动解决，解决后再次提交。</p>
<p>C.提交成功后就可以push到远程了</p>
<h4 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h4><p>当Git无法自动合并分支时，就必须首先解决冲突。解决冲突后，再提交，合并完成。</p>
<p>解决冲突就是把Git合并失败的文件手动编辑为我们希望的内容，再提交。</p>
<p>用<code>git log --graph</code>命令可以看到分支合并图。</p>
<h1 id="git同样的先后提交的东西，怎么覆盖"><a href="#git同样的先后提交的东西，怎么覆盖" class="headerlink" title="git同样的先后提交的东西，怎么覆盖"></a>git同样的先后提交的东西，怎么覆盖</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 使用一次新的commit，替代上一次提交</span><br><span class="line"># 如果代码没有任何新变化，则用来改写上一次commit的提交信息</span><br><span class="line">$ git commit --amend -m [message]</span><br></pre></td></tr></table></figure>




      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://mylym-mm.github.io/2021/09/17/18-32-40/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/hylike.jpg">
      <meta itemprop="name" content="lym">
      <meta itemprop="description" content="my的修炼之路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="my鱼">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/17/18-32-40/" class="post-title-link" itemprop="url">缓存</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-09-17 18:32:40" itemprop="dateCreated datePublished" datetime="2021-09-17T18:32:40+08:00">2021-09-17</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-09-23 22:49:04" itemprop="dateModified" datetime="2021-09-23T22:49:04+08:00">2021-09-23</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="web-worker"><a href="#web-worker" class="headerlink" title="web worker"></a>web worker</h1><h3 id="使用-Web-Workers"><a href="#使用-Web-Workers" class="headerlink" title="使用 Web Workers"></a>使用 Web Workers</h3><p>web worker 为 Web 内容在后台线程中运行脚本提供了一种简单的方法。线程可以执行任务而不干扰用户界面。此外，他们可以使用 XMLHttpRequest 执行 I/O (尽管 responseXML 和 channel 属性总是为空)。一旦创建，一个worker 可以将消息发送到创建它的 JavaScript 代码，通过将消息发布到该代码指定的事件处理程序 （反之亦然）</p>
<h3 id="Web-Workers-API"><a href="#Web-Workers-API" class="headerlink" title="Web Workers API"></a>Web Workers API</h3><p>​    一个 worker 是使用一个构造函数创建的一个对象 （e.g. Worker()）运行一个命名的 JavaScript 文件 - 这个文件包含在工作线程中运行的代码； workers 运行在另一个全局上下文中,不同于当前的<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window"><code>window</code></a>. 因此，在 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Worker"><code>Worker</code></a> 内通过 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window"><code>window</code></a>获取全局作用域 (而不是<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/self"><code>self</code></a>) 将返回错误。</p>
<p>​    在专用workers的情况下，<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/DedicatedWorkerGlobalScope"><code>DedicatedWorkerGlobalScope</code></a> 对象代表了worker的上下文（专用workers是指标准worker仅在单一脚本中被使用；共享worker的上下文是<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/SharedWorkerGlobalScope"><code>SharedWorkerGlobalScope</code> (en-US)</a>对象）。一个专用worker仅仅能被首次生成它的脚本使用，而共享worker可以同时被多个脚本使用。</p>
<p>​    在worker线程中你可以运行任何你喜欢的代码，不过有一些例外情况。比如：在worker内，不能直接操作DOM节点，也不能使用<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window"><code>window</code></a>对象的默认方法和属性。然而你可以使用大量window对象之下的东西，包括WebSockets，IndexedDB以及FireFox OS专用的Data Store API等数据存储机制。查看<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/Worker/Functions_and_classes_available_to_workers">Functions and classes available to workers</a>获取详情。</p>
<p>workers和主线程间的数据传递通过这样的消息机制进行——双方都使用postMessage()方法发送各自的消息，使用onmessage事件处理函数来响应消息（消息被包含在<code>Message</code>事件的data属性中）。这个过程中数据并不是被共享而是被复制。</p>
<p>只要运行在同源的父页面中，workers可以依次生成新的workers；并且可以使用<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest"><code>XMLHttpRequest</code></a> 进行网络I/O，但是XMLHttpRequest的responseXML和channel属性总会返回null。</p>
<h4 id="专用worker"><a href="#专用worker" class="headerlink" title="专用worker"></a><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#%E4%B8%93%E7%94%A8worker">专用worker</a></h4><p>如前文所述，一个专用worker仅仅能被生成它的脚本所使用。这一部分将探讨<a target="_blank" rel="noopener" href="https://github.com/mdn/simple-web-worker"> 专用worker基础示例</a> (<a target="_blank" rel="noopener" href="https://mdn.github.io/simple-web-worker/">运行专用worker</a>) 中的JavaScript代码：将你输入的2个数字作乘法。输入的数字会发送给一个专用worker，由专用worker作乘法后，再返回给页面进行展示。</p>
<p>这个例子很小，但是我们决定在保持简单的同时向你介绍基础的worker概念。更多的细节会在之后的文章中进行讲解。</p>
<h4 id="worker特性检测"><a href="#worker特性检测" class="headerlink" title="worker特性检测"></a><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#worker%E7%89%B9%E6%80%A7%E6%A3%80%E6%B5%8B">worker特性检测</a></h4><p>为了更好的错误处理控制以及向下兼容，将你的worker运行代码包裹在以下代码中是一个很好的想法(main.js)：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if (window.Worker) &#123;</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="生成一个专用worker"><a href="#生成一个专用worker" class="headerlink" title="生成一个专用worker"></a><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AA%E4%B8%93%E7%94%A8worker">生成一个专用worker</a></h4><p>创建一个新的worker很简单。你需要做的是调用<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Worker/Worker"><code>Worker()</code></a> 的构造器，指定一个脚本的URI来执行worker线程（main.js）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var myWorker &#x3D; new Worker(&#39;worker.js&#39;);</span><br></pre></td></tr></table></figure>

<h3 id="专用worker中消息的接收和发送"><a href="#专用worker中消息的接收和发送" class="headerlink" title="专用worker中消息的接收和发送"></a><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#%E4%B8%93%E7%94%A8worker%E4%B8%AD%E6%B6%88%E6%81%AF%E7%9A%84%E6%8E%A5%E6%94%B6%E5%92%8C%E5%8F%91%E9%80%81">专用worker中消息的接收和发送</a></h3><p>你可以通过<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Worker/postMessage"><code>postMessage()</code></a> 方法和<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Worker/onmessage"><code>onmessage</code></a>事件处理函数触发workers的方法。当你想要向一个worker发送消息时，你只需要这样做（main.js）：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">first.onchange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  myWorker.postMessage([first.value,second.value]);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Message posted to worker&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">second.onchange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  myWorker.postMessage([first.value,second.value]);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Message posted to worker&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这段代码中变量first和second代表2个<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/Input">``</a>元素；它们当中任意一个的值发生改变时，myWorker.postMessage([first.value,second.value])会将这2个值组成数组发送给worker。你可以在消息中发送许多你想发送的东西。</p>
<p>在worker中接收到消息后，我们可以写这样一个事件处理函数代码作为响应（worker.js）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">onmessage &#x3D; function(e) &#123;</span><br><span class="line">  console.log(&#39;Message received from main script&#39;);</span><br><span class="line">  var workerResult &#x3D; &#39;Result: &#39; + (e.data[0] * e.data[1]);</span><br><span class="line">  console.log(&#39;Posting message back to main script&#39;);</span><br><span class="line">  postMessage(workerResult);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>onmessage处理函数允许我们在任何时刻，一旦接收到消息就可以执行一些代码，代码中消息本身作为事件的data属性进行使用。这里我们简单的对这2个数字作乘法处理并再次使用postMessage()方法，将结果回传给主线程。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">myWorker.onmessage &#x3D; function(e) &#123;</span><br><span class="line">  result.textContent &#x3D; e.data;</span><br><span class="line">  console.log(&#39;Message received from worker&#39;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这里我们获取消息事件的data，并且将它设置为result的textContent，所以用户可以直接看到运算的结果。</p>
<p><strong>注意：</strong> 在主线程中使用时，<code>onmessage</code>和<code>postMessage()</code> 必须挂在worker对象上，而在worker中使用时不用这样做。原因是，在worker内部，worker是有效的全局作用域。</p>
<p><strong>注意：</strong> 当一个消息在主线程和worker之间传递时，它被复制或者转移了，而不是共享。请参阅<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#transferring_data_to_and_from_workers_further_details">Transferring data to and from workers: further details</a> 获取更详尽的解释。</p>
<h4 id="终止worker"><a href="#终止worker" class="headerlink" title="终止worker"></a><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#%E7%BB%88%E6%AD%A2worker">终止worker</a></h4><p>如果你需要从主线程中立刻终止一个运行中的worker，可以调用worker的<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Worker"><code>terminate</code></a> 方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myWorker.terminate();</span><br></pre></td></tr></table></figure>

<p>worker 线程会被立即杀死，不会有任何机会让它完成自己的操作或清理工作。</p>
<p>而在worker线程中，workers 也可以调用自己的 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/WorkerGlobalScope"><code>close</code></a> 方法进行关闭：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">close();</span><br></pre></td></tr></table></figure>



<h4 id="处理错误"><a href="#处理错误" class="headerlink" title="处理错误"></a><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#%E5%A4%84%E7%90%86%E9%94%99%E8%AF%AF">处理错误</a></h4><p>当 worker 出现运行中错误时，它的 <code>onerror</code> 事件处理函数会被调用。它会收到一个扩展了 <code>ErrorEvent</code> 接口的名为 <code>error</code>的事件。</p>
<p>该事件不会冒泡并且可以被取消；为了防止触发默认动作，worker 可以调用错误事件的 <code>preventDefault()</code>方法。</p>
<p>错误事件有以下三个用户关心的字段：</p>
<ul>
<li><p><code>message</code></p>
<p>可读性良好的错误消息。</p>
</li>
<li><p><code>filename</code></p>
<p>发生错误的脚本文件名。</p>
</li>
<li><p><code>lineno</code></p>
<p>发生错误时所在脚本文件的行号。</p>
</li>
</ul>
<h4 id="生成subworker"><a href="#生成subworker" class="headerlink" title="生成subworker"></a><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#%E7%94%9F%E6%88%90subworker">生成subworker</a></h4><p>如果需要的话 worker 能够生成更多的 worker。这就是所谓的subworker，它们必须托管在同源的父页面内。而且，subworker 解析  URI 时会相对于父 worker 的地址而不是自身页面的地址。这使得 worker 更容易记录它们之间的依赖关系。</p>
<h4 id="引入脚本与库"><a href="#引入脚本与库" class="headerlink" title="引入脚本与库"></a><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#%E5%BC%95%E5%85%A5%E8%84%9A%E6%9C%AC%E4%B8%8E%E5%BA%93">引入脚本与库</a></h4><p>Worker 线程能够访问一个全局函数<code>importScripts()</code>来引入脚本，该函数接受0个或者多个URI作为参数来引入资源；以下例子都是合法的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">importScripts();                        &#x2F;* 什么都不引入 *&#x2F;</span><br><span class="line">importScripts(&#39;foo.js&#39;);                &#x2F;* 只引入 &quot;foo.js&quot; *&#x2F;</span><br><span class="line">importScripts(&#39;foo.js&#39;, &#39;bar.js&#39;);      &#x2F;* 引入两个脚本 *&#x2F;</span><br></pre></td></tr></table></figure>

<p>浏览器加载并运行每一个列出的脚本。每个脚本中的全局对象都能够被 worker 使用。如果脚本无法加载，将抛出 <code>NETWORK_ERROR</code> 异常，接下来的代码也无法执行。而之前执行的代码(包括使用 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/setTimeout"><code>window.setTimeout()</code></a> 异步执行的代码)依然能够运行。<code>importScripts()</code> <strong>之后</strong>的函数声明依然会被保留，因为它们始终会在其他代码之前运行。</p>
<p><strong>注意：</strong> 脚本的下载顺序不固定，但执行时会按照传入 <code>importScripts()</code> 中的文件名顺序进行。这个过程是同步完成的；直到所有脚本都下载并运行完毕，<code>importScripts()</code> 才会返回。</p>
<h3 id="共享worker"><a href="#共享worker" class="headerlink" title="共享worker"></a><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#%E5%85%B1%E4%BA%ABworker">共享worker</a></h3><p>一个共享worker可以被多个脚本使用——即使这些脚本正在被不同的window、iframe或者worker访问。这一部分，我们会讨论<a target="_blank" rel="noopener" href="https://github.com/mdn/simple-shared-worker">共享worker基础示例</a>（<a target="_blank" rel="noopener" href="https://mdn.github.io/simple-shared-worker/">运行共享worker</a>）中的javascript代码：该示例与专用worker基础示例非常相像，只是有2个可用函数被存放在不同脚本文件中：两数相乘函数，以及求平方函数。这两个脚本用同一个worker来完成实际需要的运算。</p>
<p>这里，我们关注一下专用worker和共享worker之间的区别。在这个示例中有2个HTML页面，每个页面所包含的javascript代码使用的是同一个worker。</p>
<p><strong>注意：</strong>如果共享worker可以被多个浏览上下文调用，所有这些浏览上下文必须属于同源（相同的协议，主机和端口号）。 </p>
<p><strong>注意：</strong>在 Firefox中, 共享worker不能被私有和非私有window对象的document所共享 (<a target="_blank" rel="noopener" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1177621">bug 1177621</a>)。</p>
<h4 id="生成一个共享worker"><a href="#生成一个共享worker" class="headerlink" title="生成一个共享worker"></a><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AA%E5%85%B1%E4%BA%ABworker">生成一个共享worker</a></h4><p>生成一个新的共享worker与生成一个专用worker非常相似，只是构造器的名字不同（查看 <a target="_blank" rel="noopener" href="https://github.com/mdn/simple-shared-worker/blob/gh-pages/index.html">index.html</a> 和 <a target="_blank" rel="noopener" href="https://mdn.github.io/simple-shared-worker/index2.html">index2.html</a>）——生成共享worker的代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var myWorker &#x3D; new SharedWorker(&#39;worker.js&#39;);</span><br></pre></td></tr></table></figure>

<p>一个非常大的区别在于，与一个共享worker通信必须通过端口对象——一个确切的打开的端口供脚本与worker通信（在专用worker中这一部分是隐式进行的）。</p>
<p>在传递消息之前，端口连接必须被显式的打开，打开方式是使用onmessage事件处理函数或者start()方法。示例中的 <a target="_blank" rel="noopener" href="https://github.com/mdn/simple-shared-worker/blob/gh-pages/multiply.js">multiply.js</a> 和 <a target="_blank" rel="noopener" href="https://github.com/mdn/simple-shared-worker/blob/gh-pages/worker.js">worker.js</a> 文件没有调用了start()方法，这些调用并不那么重要是因为onmessage事件处理函数正在被使用。start()方法的调用只在一种情况下需要，那就是消息事件被addEventListener()方法使用。</p>
<p>在使用start()方法打开端口连接时，如果父级线程和worker线程需要双向通信，那么它们都需要调用start()方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myWorker.port.start();  &#x2F;&#x2F; 父级线程中的调用</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">port.start(); &#x2F;&#x2F; worker线程中的调用, 假设port变量代表一个端口</span><br></pre></td></tr></table></figure>





<h4 id="共享worker中消息的接收和发送"><a href="#共享worker中消息的接收和发送" class="headerlink" title="共享worker中消息的接收和发送"></a><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#%E5%85%B1%E4%BA%ABworker%E4%B8%AD%E6%B6%88%E6%81%AF%E7%9A%84%E6%8E%A5%E6%94%B6%E5%92%8C%E5%8F%91%E9%80%81">共享worker中消息的接收和发送</a></h4><p>现在，消息可以像之前那样发送到worker了，但是<code>postMessage()</code> 方法必须被端口对象调用（你会再一次看到 <a target="_blank" rel="noopener" href="https://github.com/mdn/simple-shared-worker/blob/gh-pages/multiply.js">multiply.js</a> 和 <a target="_blank" rel="noopener" href="https://github.com/mdn/simple-shared-worker/blob/gh-pages/square.js">square.js</a>中相似的结构）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">squareNumber.onchange &#x3D; function() &#123;</span><br><span class="line">  myWorker.port.postMessage([squareNumber.value,squareNumber.value]);</span><br><span class="line">  console.log(&#39;Message posted to worker&#39;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>回到worker中，这里也有一些些复杂（<a target="_blank" rel="noopener" href="https://github.com/mdn/simple-shared-worker/blob/gh-pages/worker.js">worker.js</a>）:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">onconnect &#x3D; function(e) &#123;</span><br><span class="line">  var port &#x3D; e.ports[0];</span><br><span class="line"></span><br><span class="line">  port.onmessage &#x3D; function(e) &#123;</span><br><span class="line">    var workerResult &#x3D; &#39;Result: &#39; + (e.data[0] * e.data[1]);</span><br><span class="line">    port.postMessage(workerResult);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>首先，当一个端口连接被创建时（例如：在父级线程中，设置onmessage事件处理函数，或者显式调用start()方法时），使用onconnect事件处理函数来执行代码。</p>
<p>使用事件的ports属性来获取端口并存储在变量中。</p>
<p>然后，为端口添加一个消息处理函数用来做运算并回传结果给主线程。在worker线程中设置此消息处理函数也会隐式的打开与主线程的端口连接，因此这里跟前文一样，对port.start()的调用也是不必要的。</p>
<p>最后，回到主脚本，我们处理消息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">myWorker.port.onmessage &#x3D; function(e) &#123;</span><br><span class="line">  result2.textContent &#x3D; e.data;</span><br><span class="line">  console.log(&#39;Message received from worker&#39;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当一条消息通过端口回到worker，我们检查结果的类型，然后将运算结果放入结果段落中合适的地方。</p>
<h3 id="关于线程安全"><a href="#关于线程安全" class="headerlink" title="关于线程安全"></a><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#%E5%85%B3%E4%BA%8E%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8">关于线程安全</a></h3><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Worker"><code>Worker</code></a>接口会生成真正的操作系统级别的线程，如果你不太小心，那么并发会对你的代码产生有趣的影响。然而，对于 web worker 来说，与其他线程的通信点会被很小心的控制，这意味着你很难引起并发问题。你没有办法去访问非线程安全的组件或者是  DOM，此外你还需要通过序列化对象来与线程交互特定的数据。所以你要是不费点劲儿，还真搞不出错误来。</p>
<h3 id="内容安全策略"><a href="#内容安全策略" class="headerlink" title="内容安全策略"></a><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#%E5%86%85%E5%AE%B9%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5">内容安全策略</a></h3><p>有别于创建它的 document 对象，worker 有它自己的执行上下文。因此普遍来说，worker 并不受限于创建它的document（或者父级worker）的内容安全策略。我们来举个例子，假设一个document 有如下头部声明</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: script-src &#39;self&#39;</span><br></pre></td></tr></table></figure>

<p>这个声明有一部分作用在于，禁止它内部包含的脚本代码使用 eval() 方法。然而，如果脚本代码创建了一个worker, 在worker 上下文中执行的代码却是可以使用 eval() 的</p>
<p>为了给 worker 指定内容安全策略，必须为发送 worker 代码的请求本身加上一个 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy">内容安全策略</a></p>
<p>有一个例外情况，即worker脚本的源如果是一个全局性的唯一的标识符（例如，它的URL指定了数据模式或者blob），worker则会继承创建它的document或者worker的CSP（Content security policy内容安全策略）。</p>
<h3 id="worker中数据的接收与发送：详细介绍"><a href="#worker中数据的接收与发送：详细介绍" class="headerlink" title="worker中数据的接收与发送：详细介绍"></a><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers#worker%E4%B8%AD%E6%95%B0%E6%8D%AE%E7%9A%84%E6%8E%A5%E6%94%B6%E4%B8%8E%E5%8F%91%E9%80%81%EF%BC%9A%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D">worker中数据的接收与发送：详细介绍</a></h3><p>在主页面与worker 之间传递的数据是通过<strong>拷贝</strong>，而不是共享来完成的。传递给 worker 的对象需要经过序列化，接下来在另一端还需要反序列化。页面与 worker <strong>不会共享同一个实例</strong>，最终的结果就是在每次通信结束时生成了数据的<strong>一个副本</strong>。大部分浏览器使用 结构化拷贝 来实现该特性。</p>
<p>在往下进行之前，出于教学的目的，让我们创建一个名为 <code>emulateMessage()</code> 的函数，它将模拟在从 <code>worker</code> 到主页面(反之亦然)的通信过程中，变量的「<em>拷贝而非共享</em>」行为：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">emulateMessage</span> (<span class="params">vVal</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">eval</span>(<span class="string">&quot;(&quot;</span> + <span class="built_in">JSON</span>.stringify(vVal) + <span class="string">&quot;)&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Tests</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// test #1</span></span><br><span class="line"><span class="keyword">var</span> example1 = <span class="keyword">new</span> <span class="built_in">Number</span>(<span class="number">3</span>);</span><br><span class="line">alert(<span class="keyword">typeof</span> example1); <span class="comment">// object</span></span><br><span class="line">alert(<span class="keyword">typeof</span> emulateMessage(example1)); <span class="comment">// number</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// test #2</span></span><br><span class="line"><span class="keyword">var</span> example2 = <span class="literal">true</span>;</span><br><span class="line">alert(<span class="keyword">typeof</span> example2); <span class="comment">// boolean</span></span><br><span class="line">alert(<span class="keyword">typeof</span> emulateMessage(example2)); <span class="comment">// boolean</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// test #3</span></span><br><span class="line"><span class="keyword">var</span> example3 = <span class="keyword">new</span> <span class="built_in">String</span>(<span class="string">&quot;Hello World&quot;</span>);</span><br><span class="line">alert(<span class="keyword">typeof</span> example3); <span class="comment">// object</span></span><br><span class="line">alert(<span class="keyword">typeof</span> emulateMessage(example3)); <span class="comment">// string</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// test #4</span></span><br><span class="line"><span class="keyword">var</span> example4 = &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;John Smith&quot;</span>,</span><br><span class="line">    <span class="string">&quot;age&quot;</span>: <span class="number">43</span></span><br><span class="line">&#125;;</span><br><span class="line">alert(<span class="keyword">typeof</span> example4); <span class="comment">// object</span></span><br><span class="line">alert(<span class="keyword">typeof</span> emulateMessage(example4)); <span class="comment">// object</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// test #5</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Animal</span> (<span class="params">sType, nAge</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.type = sType;</span><br><span class="line">    <span class="built_in">this</span>.age = nAge;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> example5 = <span class="keyword">new</span> Animal(<span class="string">&quot;Cat&quot;</span>, <span class="number">3</span>);</span><br><span class="line">alert(example5.constructor); <span class="comment">// Animal</span></span><br><span class="line">alert(emulateMessage(example5).constructor); <span class="comment">// Object</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>


<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lym</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  
<script src="/js/local-search.js"></script>






  





</body>
</html>
